/*
 * Copyright (c) 2015, Freescale Semiconductor, Inc.
 * Copyright 2016-2017 NXP
 * All rights reserved.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 */

#include "board.h"
#include "fsl_debug_console.h"
#include "fsl_gpio.h"
#include "arm_math.h"

#include "pin_mux.h"
#include "clock_config.h"


#ifndef __NN_H__
#define __NN_H__

#include "parameter.h"
#include "weight.h"
#include "arm_nnfunctions.h"
#include "local.h"
#include "sample_input_output.h"

#endif

/*******************************************************************************
 * Definitions
 ******************************************************************************/
 
#define  ARM_CM_DEMCR      (*(uint32_t *)0xE000EDFC)
 
#define  ARM_CM_DWT_CTRL   (*(uint32_t *)0xE0001000)
 
#define  ARM_CM_DWT_CYCCNT (*(uint32_t *)0xE0001004)

#define ROUND_TO_Q15(x)   ((q15_t)(x)+0.5)>(x)? ((q15_t)(x)):((q15_t)(x)+1)
 
 /*******************************************************************************
 * ATS-UNet
 ******************************************************************************/

static q15_t in_conv1_wt[IN_CONV1_IN_CH*IN_CONV1_KER_DIM_X*IN_CONV1_KER_DIM_Y*IN_CONV1_OUT_CH] = IN_CONV1_WT;
static q15_t in_conv1_bias[IN_CONV1_OUT_CH] = IN_CONV1_BIAS;

static q15_t in_conv2_wt[IN_CONV2_IN_CH*IN_CONV2_KER_DIM_X*IN_CONV2_KER_DIM_Y*IN_CONV2_OUT_CH] = IN_CONV2_WT;
static q15_t in_conv2_bias[IN_CONV2_OUT_CH] = IN_CONV2_BIAS;

static q15_t d1_conv1_wt[D1_CONV1_IN_CH*D1_CONV1_KER_DIM_X*D1_CONV1_KER_DIM_Y*D1_CONV1_OUT_CH] = D1_CONV1_WT;
static q15_t d1_conv1_bias[D1_CONV1_OUT_CH] = D1_CONV1_BIAS;

static q15_t d1_conv2_wt[D1_CONV2_IN_CH*D1_CONV2_KER_DIM_X*D1_CONV2_KER_DIM_Y*D1_CONV2_OUT_CH] = D1_CONV2_WT;
static q15_t d1_conv2_bias[D1_CONV2_OUT_CH] = D1_CONV2_BIAS;

static q15_t d2_conv1_wt[D2_CONV1_IN_CH*D2_CONV1_KER_DIM_X*D2_CONV1_KER_DIM_Y*D2_CONV1_OUT_CH] = D2_CONV1_WT;
static q15_t d2_conv1_bias[D2_CONV1_OUT_CH] = D2_CONV1_BIAS;

static q15_t d2_conv2_wt[D2_CONV2_IN_CH*D2_CONV2_KER_DIM_X*D2_CONV2_KER_DIM_Y*D2_CONV2_OUT_CH] = D2_CONV2_WT;
static q15_t d2_conv2_bias[D2_CONV2_OUT_CH] = D2_CONV2_BIAS;

static q15_t d3_conv1_wt[D3_CONV1_IN_CH*D3_CONV1_KER_DIM_X*D3_CONV1_KER_DIM_Y*D3_CONV1_OUT_CH] = D3_CONV1_WT;
static q15_t d3_conv1_bias[D3_CONV1_OUT_CH] = D3_CONV1_BIAS;

static q15_t d3_conv2_wt[D3_CONV2_IN_CH*D3_CONV2_KER_DIM_X*D3_CONV2_KER_DIM_Y*D3_CONV2_OUT_CH] = D3_CONV2_WT;
static q15_t d3_conv2_bias[D3_CONV2_OUT_CH] = D3_CONV2_BIAS;

static q15_t d4_conv1_wt[D4_CONV1_IN_CH*D4_CONV1_KER_DIM_X*D4_CONV1_KER_DIM_Y*D4_CONV1_OUT_CH] = D4_CONV1_WT;
static q15_t d4_conv1_bias[D4_CONV1_OUT_CH] = D4_CONV1_BIAS;

static q15_t d4_conv2_wt[D4_CONV2_IN_CH*D4_CONV2_KER_DIM_X*D4_CONV2_KER_DIM_Y*D4_CONV2_OUT_CH] = D4_CONV2_WT;
static q15_t d4_conv2_bias[D4_CONV2_OUT_CH] = D4_CONV2_BIAS;

static q15_t d5_conv1_wt[D5_CONV1_IN_CH*D5_CONV1_KER_DIM_X*D5_CONV1_KER_DIM_Y*D5_CONV1_OUT_CH] = D5_CONV1_WT;
static q15_t d5_conv1_bias[D5_CONV1_OUT_CH] = D5_CONV1_BIAS;

static q15_t d5_conv2_wt[D5_CONV2_IN_CH*D5_CONV2_KER_DIM_X*D5_CONV2_KER_DIM_Y*D5_CONV2_OUT_CH] = D5_CONV2_WT;
static q15_t d5_conv2_bias[D5_CONV2_OUT_CH] = D5_CONV2_BIAS;

static q15_t u1_conv1_wt[U1_CONV1_IN_CH*U1_CONV1_KER_DIM_X*U1_CONV1_KER_DIM_Y*U1_CONV1_OUT_CH] = U1_CONV1_WT;
static q15_t u1_conv1_bias[U1_CONV1_OUT_CH] = U1_CONV1_BIAS;

static q15_t u1_conv2_wt[U1_CONV2_IN_CH*U1_CONV2_KER_DIM_X*U1_CONV2_KER_DIM_Y*U1_CONV2_OUT_CH] = U1_CONV2_WT;
static q15_t u1_conv2_bias[U1_CONV2_OUT_CH] = U1_CONV2_BIAS;

static q15_t u2_conv1_wt[U2_CONV1_IN_CH*U2_CONV1_KER_DIM_X*U2_CONV1_KER_DIM_Y*U2_CONV1_OUT_CH] = U2_CONV1_WT;
static q15_t u2_conv1_bias[U2_CONV1_OUT_CH] = U2_CONV1_BIAS;

static q15_t u2_conv2_wt[U2_CONV2_IN_CH*U2_CONV2_KER_DIM_X*U2_CONV2_KER_DIM_Y*U2_CONV2_OUT_CH] = U2_CONV2_WT;
static q15_t u2_conv2_bias[U2_CONV2_OUT_CH] = U2_CONV2_BIAS;

static q15_t u3_conv1_wt[U3_CONV1_IN_CH*U3_CONV1_KER_DIM_X*U3_CONV1_KER_DIM_Y*U3_CONV1_OUT_CH] = U3_CONV1_WT;
static q15_t u3_conv1_bias[U3_CONV1_OUT_CH] = U3_CONV1_BIAS;

static q15_t u3_conv2_wt[U3_CONV2_IN_CH*U3_CONV2_KER_DIM_X*U3_CONV2_KER_DIM_Y*U3_CONV2_OUT_CH] = U3_CONV2_WT;
static q15_t u3_conv2_bias[U3_CONV2_OUT_CH] = U3_CONV2_BIAS;

static q15_t u4_conv1_wt[U4_CONV1_IN_CH*U4_CONV1_KER_DIM_X*U4_CONV1_KER_DIM_Y*U4_CONV1_OUT_CH] = U4_CONV1_WT;
static q15_t u4_conv1_bias[U4_CONV1_OUT_CH] = U4_CONV1_BIAS;

static q15_t u4_conv2_wt[U4_CONV2_IN_CH*U4_CONV2_KER_DIM_X*U4_CONV2_KER_DIM_Y*U4_CONV2_OUT_CH] = U4_CONV2_WT;
static q15_t u4_conv2_bias[U4_CONV2_OUT_CH] = U4_CONV2_BIAS;

static q15_t u5_conv1_wt[U5_CONV1_IN_CH*U5_CONV1_KER_DIM_X*U5_CONV1_KER_DIM_Y*U5_CONV1_OUT_CH] = U5_CONV1_WT;
static q15_t u5_conv1_bias[U5_CONV1_OUT_CH] = U5_CONV1_BIAS;

static q15_t u5_conv2_wt[U5_CONV2_IN_CH*U5_CONV2_KER_DIM_X*U5_CONV2_KER_DIM_Y*U5_CONV2_OUT_CH] = U5_CONV2_WT;
static q15_t u5_conv2_bias[U5_CONV2_OUT_CH] = U5_CONV2_BIAS;

static q15_t out_conv_wt[OUT_CONV_IN_CH*OUT_CONV_KER_DIM_X*OUT_CONV_KER_DIM_Y*OUT_CONV_OUT_CH] = OUT_WT;
static q15_t out_conv_bias[OUT_CONV_OUT_CH] = OUT_BIAS;

q15_t col_buffer[288]; // 2 * 8 * 3 * 3
q15_t scratch_buffer[9216*3];
q15_t skip_buffer[19584]; // 256*4*9+128*4*9+64*4*9+32*8*9+16*8*9

void run_nn(q15_t* input_data, q15_t* output_data) {
	q15_t* buffer1 = scratch_buffer;
	q15_t* buffer2 = buffer1 + 9216 * 2;
	q15_t* skip_buffer1 = skip_buffer;
	q15_t* skip_buffer2 = skip_buffer + 256 * 4 * 9;
	q15_t* skip_buffer3 = skip_buffer + 256 * 4 * 9 + 128 * 4 * 9;
	q15_t* skip_buffer4 = skip_buffer + 256 * 4 * 9 + 128 * 4 * 9 + 64 * 4 * 9;
	q15_t* skip_buffer5 = skip_buffer + 256 * 4 * 9 + 128 * 4 * 9 + 64 * 4 * 9 + 32 * 8 * 9;
	
	arm_convolve_HWC_q15_nonsquare_ref(input_data, IN_CONV1_IN_DIM_X, IN_CONV1_IN_DIM_Y, IN_CONV1_IN_CH, in_conv1_wt, IN_CONV1_OUT_CH, IN_CONV1_KER_DIM_X, IN_CONV1_KER_DIM_Y, IN_CONV1_PAD_X, IN_CONV1_PAD_Y, IN_CONV1_STRIDE_X, IN_CONV1_STRIDE_Y, in_conv1_bias, IN_CONV1_BIAS_LSHIFT, IN_CONV1_OUT_RSHIFT, buffer1, IN_CONV1_OUT_DIM_X, IN_CONV1_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer1, IN_CONV1_RELU_OUT_CH*IN_CONV1_RELU_OUT_DIM_X*IN_CONV1_RELU_OUT_DIM_Y);
	arm_convolve_HWC_q15_fast_nonsquare(buffer1, IN_CONV2_IN_DIM_X, IN_CONV2_IN_DIM_Y, IN_CONV2_IN_CH, in_conv2_wt, IN_CONV2_OUT_CH, IN_CONV2_KER_DIM_X, IN_CONV2_KER_DIM_Y, IN_CONV2_PAD_X, IN_CONV2_PAD_Y, IN_CONV2_STRIDE_X, IN_CONV2_STRIDE_Y, in_conv2_bias, IN_CONV2_BIAS_LSHIFT, IN_CONV2_OUT_RSHIFT, buffer2, IN_CONV2_OUT_DIM_X, IN_CONV2_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer2, IN_CONV2_RELU_OUT_CH*IN_CONV2_RELU_OUT_DIM_X*IN_CONV2_RELU_OUT_DIM_Y);
	memcpy(skip_buffer1, buffer2, IN_CONV2_RELU_OUT_CH*IN_CONV2_RELU_OUT_DIM_X*IN_CONV2_RELU_OUT_DIM_Y*sizeof(q15_t));
	
	local_maxpool_q15_HWC(buffer2, D1_POOL_IN_DIM_X, D1_POOL_IN_DIM_Y, D1_POOL_IN_CH, D1_POOL_KER_DIM_X, D1_POOL_KER_DIM_Y, D1_POOL_PAD_X, D1_POOL_PAD_Y, D1_POOL_STRIDE_X, D1_POOL_STRIDE_Y, D1_POOL_OUT_DIM_X, D1_POOL_OUT_DIM_Y, NULL, buffer1);
	arm_convolve_HWC_q15_fast_nonsquare(buffer1, D1_CONV1_IN_DIM_X, D1_CONV1_IN_DIM_Y, D1_CONV1_IN_CH, d1_conv1_wt, D1_CONV1_OUT_CH, D1_CONV1_KER_DIM_X, D1_CONV1_KER_DIM_Y, D1_CONV1_PAD_X, D1_CONV1_PAD_Y, D1_CONV1_STRIDE_X, D1_CONV1_STRIDE_Y, d1_conv1_bias, D1_CONV1_BIAS_LSHIFT, D1_CONV1_OUT_RSHIFT, buffer2, D1_CONV1_OUT_DIM_X, D1_CONV1_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer2, D1_CONV1_RELU_OUT_CH*D1_CONV1_RELU_OUT_DIM_X*D1_CONV1_RELU_OUT_DIM_Y);
	arm_convolve_HWC_q15_fast_nonsquare(buffer2, D1_CONV2_IN_DIM_X, D1_CONV2_IN_DIM_Y, D1_CONV2_IN_CH, d1_conv2_wt, D1_CONV2_OUT_CH, D1_CONV2_KER_DIM_X, D1_CONV2_KER_DIM_Y, D1_CONV2_PAD_X, D1_CONV2_PAD_Y, D1_CONV2_STRIDE_X, D1_CONV2_STRIDE_Y, d1_conv2_bias, D1_CONV2_BIAS_LSHIFT, D1_CONV2_OUT_RSHIFT, buffer1, D1_CONV2_OUT_DIM_X, D1_CONV2_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer1, D1_CONV2_RELU_OUT_CH*D1_CONV2_RELU_OUT_DIM_X*D1_CONV2_RELU_OUT_DIM_Y);
	local_tsm_q15_HWC(buffer1, D1_CONV2_RELU_OUT_CH, D1_CONV2_RELU_OUT_DIM_X, D1_CONV2_RELU_OUT_DIM_Y);
	memcpy(skip_buffer2, buffer1, D1_CONV2_RELU_OUT_CH*D1_CONV2_RELU_OUT_DIM_X*D1_CONV2_RELU_OUT_DIM_Y*sizeof(q15_t));
	
	local_maxpool_q15_HWC(buffer1, D2_POOL_IN_DIM_X, D2_POOL_IN_DIM_Y, D2_POOL_IN_CH, D2_POOL_KER_DIM_X, D2_POOL_KER_DIM_Y, D2_POOL_PAD_X, D2_POOL_PAD_Y, D2_POOL_STRIDE_X, D2_POOL_STRIDE_Y, D2_POOL_OUT_DIM_X, D2_POOL_OUT_DIM_Y, NULL, buffer2);
	arm_convolve_HWC_q15_fast_nonsquare(buffer2, D2_CONV1_IN_DIM_X, D2_CONV1_IN_DIM_Y, D2_CONV1_IN_CH, d2_conv1_wt, D2_CONV1_OUT_CH, D2_CONV1_KER_DIM_X, D2_CONV1_KER_DIM_Y, D2_CONV1_PAD_X, D2_CONV1_PAD_Y, D2_CONV1_STRIDE_X, D2_CONV1_STRIDE_Y, d2_conv1_bias, D2_CONV1_BIAS_LSHIFT, D2_CONV1_OUT_RSHIFT, buffer1, D2_CONV1_OUT_DIM_X, D2_CONV1_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer1, D2_CONV1_RELU_OUT_CH*D2_CONV1_RELU_OUT_DIM_X*D2_CONV1_RELU_OUT_DIM_Y);
	arm_convolve_HWC_q15_fast_nonsquare(buffer1, D2_CONV2_IN_DIM_X, D2_CONV2_IN_DIM_Y, D2_CONV2_IN_CH, d2_conv2_wt, D2_CONV2_OUT_CH, D2_CONV2_KER_DIM_X, D2_CONV2_KER_DIM_Y, D2_CONV2_PAD_X, D2_CONV2_PAD_Y, D2_CONV2_STRIDE_X, D2_CONV2_STRIDE_Y, d2_conv2_bias, D2_CONV2_BIAS_LSHIFT, D2_CONV2_OUT_RSHIFT, buffer2, D2_CONV2_OUT_DIM_X, D2_CONV2_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer2, D2_CONV2_RELU_OUT_CH*D2_CONV2_RELU_OUT_DIM_X*D2_CONV2_RELU_OUT_DIM_Y);
	local_tsm_q15_HWC(buffer2, D2_CONV2_RELU_OUT_CH, D2_CONV2_RELU_OUT_DIM_X, D2_CONV2_RELU_OUT_DIM_Y);
	memcpy(skip_buffer3, buffer2, D2_CONV2_RELU_OUT_CH*D2_CONV2_RELU_OUT_DIM_X*D2_CONV2_RELU_OUT_DIM_Y*sizeof(q15_t));
	
	local_maxpool_q15_HWC(buffer2, D3_POOL_IN_DIM_X, D3_POOL_IN_DIM_Y, D3_POOL_IN_CH, D3_POOL_KER_DIM_X, D3_POOL_KER_DIM_Y, D3_POOL_PAD_X, D3_POOL_PAD_Y, D3_POOL_STRIDE_X, D3_POOL_STRIDE_Y, D3_POOL_OUT_DIM_X, D3_POOL_OUT_DIM_Y, NULL, buffer1);
	arm_convolve_HWC_q15_fast_nonsquare(buffer1, D3_CONV1_IN_DIM_X, D3_CONV1_IN_DIM_Y, D3_CONV1_IN_CH, d3_conv1_wt, D3_CONV1_OUT_CH, D3_CONV1_KER_DIM_X, D3_CONV1_KER_DIM_Y, D3_CONV1_PAD_X, D3_CONV1_PAD_Y, D3_CONV1_STRIDE_X, D3_CONV1_STRIDE_Y, d3_conv1_bias, D3_CONV1_BIAS_LSHIFT, D3_CONV1_OUT_RSHIFT, buffer2, D3_CONV1_OUT_DIM_X, D3_CONV1_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer2, D3_CONV1_RELU_OUT_CH*D3_CONV1_RELU_OUT_DIM_X*D3_CONV1_RELU_OUT_DIM_Y);
	arm_convolve_HWC_q15_fast_nonsquare(buffer2, D3_CONV2_IN_DIM_X, D3_CONV2_IN_DIM_Y, D3_CONV2_IN_CH, d3_conv2_wt, D3_CONV2_OUT_CH, D3_CONV2_KER_DIM_X, D3_CONV2_KER_DIM_Y, D3_CONV2_PAD_X, D3_CONV2_PAD_Y, D3_CONV2_STRIDE_X, D3_CONV2_STRIDE_Y, d3_conv2_bias, D3_CONV2_BIAS_LSHIFT, D3_CONV2_OUT_RSHIFT, buffer1, D3_CONV2_OUT_DIM_X, D3_CONV2_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer1, D3_CONV2_RELU_OUT_CH*D3_CONV2_RELU_OUT_DIM_X*D3_CONV2_RELU_OUT_DIM_Y);
	local_tsm_q15_HWC(buffer1, D3_CONV2_RELU_OUT_CH, D3_CONV2_RELU_OUT_DIM_X, D3_CONV2_RELU_OUT_DIM_Y);
	memcpy(skip_buffer4, buffer1, D3_CONV2_RELU_OUT_CH*D3_CONV2_RELU_OUT_DIM_X*D3_CONV2_RELU_OUT_DIM_Y*sizeof(q15_t));
	
	local_maxpool_q15_HWC(buffer1, D4_POOL_IN_DIM_X, D4_POOL_IN_DIM_Y, D4_POOL_IN_CH, D4_POOL_KER_DIM_X, D4_POOL_KER_DIM_Y, D4_POOL_PAD_X, D4_POOL_PAD_Y, D4_POOL_STRIDE_X, D4_POOL_STRIDE_Y, D4_POOL_OUT_DIM_X, D4_POOL_OUT_DIM_Y, NULL, buffer2);
	arm_convolve_HWC_q15_fast_nonsquare(buffer2, D4_CONV1_IN_DIM_X, D4_CONV1_IN_DIM_Y, D4_CONV1_IN_CH, d4_conv1_wt, D4_CONV1_OUT_CH, D4_CONV1_KER_DIM_X, D4_CONV1_KER_DIM_Y, D4_CONV1_PAD_X, D4_CONV1_PAD_Y, D4_CONV1_STRIDE_X, D4_CONV1_STRIDE_Y, d4_conv1_bias, D4_CONV1_BIAS_LSHIFT, D4_CONV1_OUT_RSHIFT, buffer1, D4_CONV1_OUT_DIM_X, D4_CONV1_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer1, D4_CONV1_RELU_OUT_CH*D4_CONV1_RELU_OUT_DIM_X*D4_CONV1_RELU_OUT_DIM_Y);
	arm_convolve_HWC_q15_fast_nonsquare(buffer1, D4_CONV2_IN_DIM_X, D4_CONV2_IN_DIM_Y, D4_CONV2_IN_CH, d4_conv2_wt, D4_CONV2_OUT_CH, D4_CONV2_KER_DIM_X, D4_CONV2_KER_DIM_Y, D4_CONV2_PAD_X, D4_CONV2_PAD_Y, D4_CONV2_STRIDE_X, D4_CONV2_STRIDE_Y, d4_conv2_bias, D4_CONV2_BIAS_LSHIFT, D4_CONV2_OUT_RSHIFT, buffer2, D4_CONV2_OUT_DIM_X, D4_CONV2_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer2, D4_CONV2_RELU_OUT_CH*D4_CONV2_RELU_OUT_DIM_X*D4_CONV2_RELU_OUT_DIM_Y);
	local_tsm_q15_HWC(buffer2, D4_CONV2_RELU_OUT_CH, D4_CONV2_RELU_OUT_DIM_X, D4_CONV2_RELU_OUT_DIM_Y);
	memcpy(skip_buffer5, buffer2, D4_CONV2_RELU_OUT_CH*D4_CONV2_RELU_OUT_DIM_X*D4_CONV2_RELU_OUT_DIM_Y*sizeof(q15_t));
	
	local_maxpool_q15_HWC(buffer2, D5_POOL_IN_DIM_X, D5_POOL_IN_DIM_Y, D5_POOL_IN_CH, D5_POOL_KER_DIM_X, D5_POOL_KER_DIM_Y, D5_POOL_PAD_X, D5_POOL_PAD_Y, D5_POOL_STRIDE_X, D5_POOL_STRIDE_Y, D5_POOL_OUT_DIM_X, D5_POOL_OUT_DIM_Y, NULL, buffer1);
	arm_convolve_HWC_q15_fast_nonsquare(buffer1, D5_CONV1_IN_DIM_X, D5_CONV1_IN_DIM_Y, D5_CONV1_IN_CH, d5_conv1_wt, D5_CONV1_OUT_CH, D5_CONV1_KER_DIM_X, D5_CONV1_KER_DIM_Y, D5_CONV1_PAD_X, D5_CONV1_PAD_Y, D5_CONV1_STRIDE_X, D5_CONV1_STRIDE_Y, d5_conv1_bias, D5_CONV1_BIAS_LSHIFT, D5_CONV1_OUT_RSHIFT, buffer2, D5_CONV1_OUT_DIM_X, D5_CONV1_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer2, D5_CONV1_RELU_OUT_CH*D5_CONV1_RELU_OUT_DIM_X*D5_CONV1_RELU_OUT_DIM_Y);
	arm_convolve_HWC_q15_fast_nonsquare(buffer2, D5_CONV2_IN_DIM_X, D5_CONV2_IN_DIM_Y, D5_CONV2_IN_CH, d5_conv2_wt, D5_CONV2_OUT_CH, D5_CONV2_KER_DIM_X, D5_CONV2_KER_DIM_Y, D5_CONV2_PAD_X, D5_CONV2_PAD_Y, D5_CONV2_STRIDE_X, D5_CONV2_STRIDE_Y, d5_conv2_bias, D5_CONV2_BIAS_LSHIFT, D5_CONV2_OUT_RSHIFT, buffer1, D5_CONV2_OUT_DIM_X, D5_CONV2_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer1, D5_CONV2_RELU_OUT_CH*D5_CONV2_RELU_OUT_DIM_X*D5_CONV2_RELU_OUT_DIM_Y);
	local_tsm_q15_HWC(buffer1, D5_CONV2_RELU_OUT_CH, D5_CONV2_RELU_OUT_DIM_X, D5_CONV2_RELU_OUT_DIM_Y);
	
	local_up_sampling_q15_HWC(buffer1, U1_UP_IN_DIM_X, U1_UP_IN_DIM_Y, U1_UP_IN_CH, U1_UP_KER_DIM_X, U1_UP_KER_DIM_Y, U1_UP_OUT_DIM_X, U1_UP_OUT_DIM_Y, NULL, buffer2);
	local_cat_q15_HWC(skip_buffer5, buffer2, U1_CAT_CH1, U1_CAT_CH2, U1_CAT_DIM_X, U1_CAT_DIM_Y, buffer1);
	arm_convolve_HWC_q15_fast_nonsquare(buffer1, U1_CONV1_IN_DIM_X, U1_CONV1_IN_DIM_Y, U1_CONV1_IN_CH, u1_conv1_wt, U1_CONV1_OUT_CH, U1_CONV1_KER_DIM_X, U1_CONV1_KER_DIM_Y, U1_CONV1_PAD_X, U1_CONV1_PAD_Y, U1_CONV1_STRIDE_X, U1_CONV1_STRIDE_Y, u1_conv1_bias, U1_CONV1_BIAS_LSHIFT, U1_CONV1_OUT_RSHIFT, buffer2, U1_CONV1_OUT_DIM_X, U1_CONV1_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer2, U1_CONV1_RELU_OUT_CH*U1_CONV1_RELU_OUT_DIM_X*U1_CONV1_RELU_OUT_DIM_Y);
	arm_convolve_HWC_q15_fast_nonsquare(buffer2, U1_CONV2_IN_DIM_X, U1_CONV2_IN_DIM_Y, U1_CONV2_IN_CH, u1_conv2_wt, U1_CONV2_OUT_CH, U1_CONV2_KER_DIM_X, U1_CONV2_KER_DIM_Y, U1_CONV2_PAD_X, U1_CONV2_PAD_Y, U1_CONV2_STRIDE_X, U1_CONV2_STRIDE_Y, u1_conv2_bias, U1_CONV2_BIAS_LSHIFT, U1_CONV2_OUT_RSHIFT, buffer1, U1_CONV2_OUT_DIM_X, U1_CONV2_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer1, U1_CONV2_RELU_OUT_CH*U1_CONV2_RELU_OUT_DIM_X*U1_CONV2_RELU_OUT_DIM_Y);
	local_tsm_q15_HWC(buffer1, U1_CONV2_RELU_OUT_CH, U1_CONV2_RELU_OUT_DIM_X, U1_CONV2_RELU_OUT_DIM_Y);
	
	local_up_sampling_q15_HWC(buffer1, U2_UP_IN_DIM_X, U2_UP_IN_DIM_Y, U2_UP_IN_CH, U2_UP_KER_DIM_X, U2_UP_KER_DIM_Y, U2_UP_OUT_DIM_X, U2_UP_OUT_DIM_Y, NULL, buffer2);
	local_cat_q15_HWC(skip_buffer4, buffer2, U2_CAT_CH1, U2_CAT_CH2, U2_CAT_DIM_X, U2_CAT_DIM_Y, buffer1);
	arm_convolve_HWC_q15_fast_nonsquare(buffer1, U2_CONV1_IN_DIM_X, U2_CONV1_IN_DIM_Y, U2_CONV1_IN_CH, u2_conv1_wt, U2_CONV1_OUT_CH, U2_CONV1_KER_DIM_X, U2_CONV1_KER_DIM_Y, U2_CONV1_PAD_X, U2_CONV1_PAD_Y, U2_CONV1_STRIDE_X, U2_CONV1_STRIDE_Y, u2_conv1_bias, U2_CONV1_BIAS_LSHIFT, U2_CONV1_OUT_RSHIFT, buffer2, U2_CONV1_OUT_DIM_X, U2_CONV1_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer2, U2_CONV1_RELU_OUT_CH*U2_CONV1_RELU_OUT_DIM_X*U2_CONV1_RELU_OUT_DIM_Y);
	arm_convolve_HWC_q15_fast_nonsquare(buffer2, U2_CONV2_IN_DIM_X, U2_CONV2_IN_DIM_Y, U2_CONV2_IN_CH, u2_conv2_wt, U2_CONV2_OUT_CH, U2_CONV2_KER_DIM_X, U2_CONV2_KER_DIM_Y, U2_CONV2_PAD_X, U2_CONV2_PAD_Y, U2_CONV2_STRIDE_X, U2_CONV2_STRIDE_Y, u2_conv2_bias, U2_CONV2_BIAS_LSHIFT, U2_CONV2_OUT_RSHIFT, buffer1, U2_CONV2_OUT_DIM_X, U2_CONV2_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer1, U2_CONV2_RELU_OUT_CH*U2_CONV2_RELU_OUT_DIM_X*U2_CONV2_RELU_OUT_DIM_Y);
	local_tsm_q15_HWC(buffer1, U2_CONV2_RELU_OUT_CH, U2_CONV2_RELU_OUT_DIM_X, U2_CONV2_RELU_OUT_DIM_Y);
	
	local_up_sampling_q15_HWC(buffer1, U3_UP_IN_DIM_X, U3_UP_IN_DIM_Y, U3_UP_IN_CH, U3_UP_KER_DIM_X, U3_UP_KER_DIM_Y, U3_UP_OUT_DIM_X, U3_UP_OUT_DIM_Y, NULL, buffer2);
	local_cat_q15_HWC(skip_buffer3, buffer2, U3_CAT_CH1, U3_CAT_CH2, U3_CAT_DIM_X, U3_CAT_DIM_Y, buffer1);
	arm_convolve_HWC_q15_fast_nonsquare(buffer1, U3_CONV1_IN_DIM_X, U3_CONV1_IN_DIM_Y, U3_CONV1_IN_CH, u3_conv1_wt, U3_CONV1_OUT_CH, U3_CONV1_KER_DIM_X, U3_CONV1_KER_DIM_Y, U3_CONV1_PAD_X, U3_CONV1_PAD_Y, U3_CONV1_STRIDE_X, U3_CONV1_STRIDE_Y, u3_conv1_bias, U3_CONV1_BIAS_LSHIFT, U3_CONV1_OUT_RSHIFT, buffer2, U3_CONV1_OUT_DIM_X, U3_CONV1_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer2, U3_CONV1_RELU_OUT_CH*U3_CONV1_RELU_OUT_DIM_X*U3_CONV1_RELU_OUT_DIM_Y);
	arm_convolve_HWC_q15_fast_nonsquare(buffer2, U3_CONV2_IN_DIM_X, U3_CONV2_IN_DIM_Y, U3_CONV2_IN_CH, u3_conv2_wt, U3_CONV2_OUT_CH, U3_CONV2_KER_DIM_X, U3_CONV2_KER_DIM_Y, U3_CONV2_PAD_X, U3_CONV2_PAD_Y, U3_CONV2_STRIDE_X, U3_CONV2_STRIDE_Y, u3_conv2_bias, U3_CONV2_BIAS_LSHIFT, U3_CONV2_OUT_RSHIFT, buffer1, U3_CONV2_OUT_DIM_X, U3_CONV2_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer1, U3_CONV2_RELU_OUT_CH*U3_CONV2_RELU_OUT_DIM_X*U3_CONV2_RELU_OUT_DIM_Y);
	local_tsm_q15_HWC(buffer1, U3_CONV2_RELU_OUT_CH, U3_CONV2_RELU_OUT_DIM_X, U3_CONV2_RELU_OUT_DIM_Y);
	
	local_up_sampling_q15_HWC(buffer1, U4_UP_IN_DIM_X, U4_UP_IN_DIM_Y, U4_UP_IN_CH, U4_UP_KER_DIM_X, U4_UP_KER_DIM_Y, U4_UP_OUT_DIM_X, U4_UP_OUT_DIM_Y, NULL, buffer2);
	local_cat_q15_HWC(skip_buffer2, buffer2, U4_CAT_CH1, U4_CAT_CH2, U4_CAT_DIM_X, U4_CAT_DIM_Y, buffer1);
	arm_convolve_HWC_q15_fast_nonsquare(buffer1, U4_CONV1_IN_DIM_X, U4_CONV1_IN_DIM_Y, U4_CONV1_IN_CH, u4_conv1_wt, U4_CONV1_OUT_CH, U4_CONV1_KER_DIM_X, U4_CONV1_KER_DIM_Y, U4_CONV1_PAD_X, U4_CONV1_PAD_Y, U4_CONV1_STRIDE_X, U4_CONV1_STRIDE_Y, u4_conv1_bias, U4_CONV1_BIAS_LSHIFT, U4_CONV1_OUT_RSHIFT, buffer2, U4_CONV1_OUT_DIM_X, U4_CONV1_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer2, U4_CONV1_RELU_OUT_CH*U4_CONV1_RELU_OUT_DIM_X*U4_CONV1_RELU_OUT_DIM_Y);
	arm_convolve_HWC_q15_fast_nonsquare(buffer2, U4_CONV2_IN_DIM_X, U4_CONV2_IN_DIM_Y, U4_CONV2_IN_CH, u4_conv2_wt, U4_CONV2_OUT_CH, U4_CONV2_KER_DIM_X, U4_CONV2_KER_DIM_Y, U4_CONV2_PAD_X, U4_CONV2_PAD_Y, U4_CONV2_STRIDE_X, U4_CONV2_STRIDE_Y, u4_conv2_bias, U4_CONV2_BIAS_LSHIFT, U4_CONV2_OUT_RSHIFT, buffer1, U4_CONV2_OUT_DIM_X, U4_CONV2_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer1, U4_CONV2_RELU_OUT_CH*U4_CONV2_RELU_OUT_DIM_X*U4_CONV2_RELU_OUT_DIM_Y);
	local_tsm_q15_HWC(buffer1, U4_CONV2_RELU_OUT_CH, U4_CONV2_RELU_OUT_DIM_X, U4_CONV2_RELU_OUT_DIM_Y);
	
	local_up_sampling_q15_HWC(buffer1, U5_UP_IN_DIM_X, U5_UP_IN_DIM_Y, U5_UP_IN_CH, U5_UP_KER_DIM_X, U5_UP_KER_DIM_Y, U5_UP_OUT_DIM_X, U5_UP_OUT_DIM_Y, NULL, buffer2);
	local_cat_q15_HWC(skip_buffer1, buffer2, U5_CAT_CH1, U5_CAT_CH2, U5_CAT_DIM_X, U5_CAT_DIM_Y, buffer1);
	arm_convolve_HWC_q15_fast_nonsquare(buffer1, U5_CONV1_IN_DIM_X, U5_CONV1_IN_DIM_Y, U5_CONV1_IN_CH, u5_conv1_wt, U5_CONV1_OUT_CH, U5_CONV1_KER_DIM_X, U5_CONV1_KER_DIM_Y, U5_CONV1_PAD_X, U5_CONV1_PAD_Y, U5_CONV1_STRIDE_X, U5_CONV1_STRIDE_Y, u5_conv1_bias, U5_CONV1_BIAS_LSHIFT, U5_CONV1_OUT_RSHIFT, buffer2, U5_CONV1_OUT_DIM_X, U5_CONV1_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer2, U5_CONV1_RELU_OUT_CH*U5_CONV1_RELU_OUT_DIM_X*U5_CONV1_RELU_OUT_DIM_Y);
	arm_convolve_HWC_q15_fast_nonsquare(buffer2, U5_CONV2_IN_DIM_X, U5_CONV2_IN_DIM_Y, U5_CONV2_IN_CH, u5_conv2_wt, U5_CONV2_OUT_CH, U5_CONV2_KER_DIM_X, U5_CONV2_KER_DIM_Y, U5_CONV2_PAD_X, U5_CONV2_PAD_Y, U5_CONV2_STRIDE_X, U5_CONV2_STRIDE_Y, u5_conv2_bias, U5_CONV2_BIAS_LSHIFT, U5_CONV2_OUT_RSHIFT, buffer1, U5_CONV2_OUT_DIM_X, U5_CONV2_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
	arm_relu_q15(buffer1, U5_CONV2_RELU_OUT_CH*U5_CONV2_RELU_OUT_DIM_X*U5_CONV2_RELU_OUT_DIM_Y);
	
	arm_convolve_HWC_q15_nonsquare_ref(buffer1, OUT_CONV_IN_DIM_X, OUT_CONV_IN_DIM_Y, OUT_CONV_IN_CH, out_conv_wt, OUT_CONV_OUT_CH, OUT_CONV_KER_DIM_X, OUT_CONV_KER_DIM_Y, OUT_CONV_PAD_X, OUT_CONV_PAD_Y, OUT_CONV_STRIDE_X, OUT_CONV_STRIDE_Y, out_conv_bias, OUT_BIAS_LSHIFT, OUT_OUT_RSHIFT, output_data, OUT_CONV_OUT_DIM_X, OUT_CONV_OUT_DIM_Y, (q15_t*)col_buffer, NULL);
} 


/*******************************************************************************
 * DSP
 ******************************************************************************/
 
#define INPUT_FRAME_SIZE	(1024)
#define PRE_PADDING_SIZE	(256)
#define POST_PADDING_SIZE	(256)
#define INPUT_BUFFER_SIZE	(INPUT_FRAME_SIZE * 2 + PRE_PADDING_SIZE + POST_PADDING_SIZE) // 2048 + 512

#define FFT_SIZE			(512)
#define FFT_STEP			(256)

#define FFT_FRAMES			((INPUT_BUFFER_SIZE - FFT_STEP) / FFT_STEP)  // 9

typedef struct
{
	float32_t input_buffer[INPUT_BUFFER_SIZE];	//this is used to store total input, put new input data at the end of this buffer
	float32_t output_buffer[INPUT_BUFFER_SIZE];
	float32_t pWindow[FFT_SIZE];

	arm_rfft_fast_instance_f32	fft;
	float32_t fft_tmp[FFT_SIZE];

	float32_t fft_result[FFT_SIZE * FFT_FRAMES];	//store tmp fft result
	float32_t nn_input[(FFT_SIZE / 2) * FFT_FRAMES];
	q15_t nn_input_q15[(FFT_SIZE / 2) * FFT_FRAMES];
	float32_t nn_output[(FFT_SIZE / 2) * FFT_FRAMES];
	q15_t nn_output_q15[(FFT_SIZE / 2) * FFT_FRAMES];
}nn_t;

static nn_t nn;

float32_t test_input[INPUT_FRAME_SIZE];
float32_t test_output[INPUT_FRAME_SIZE];

const float32_t HANNING_WIN[FFT_SIZE] = {0.0, 3.764907887671143e-05, 0.00015059065481182188, 0.00033880770206451416, 0.0006022718735039234, 0.0009409435442648828, 0.0013547716662287712, 0.0018436938989907503, 0.0024076367262750864, 0.003046514932066202, 0.003760232590138912, 0.004548682365566492, 0.005411745049059391, 0.00634929072111845, 0.007361178752034903, 0.008447255939245224, 0.009607359766960144, 0.010841314680874348, 0.012148935347795486, 0.013530024327337742, 0.0149843730032444, 0.016511764377355576, 0.01811196655035019, 0.01978474110364914, 0.02152983285486698, 0.023346979171037674, 0.025235909968614578, 0.027196336537599564, 0.02922796830534935, 0.03133049234747887, 0.03350359946489334, 0.03574695810675621, 0.03806023299694061, 0.04044307395815849, 0.0428951233625412, 0.045416008681058884, 0.0480053536593914, 0.05066276714205742, 0.053387850522994995, 0.056180190294981, 0.059039369225502014, 0.06196495145559311, 0.06495650112628937, 0.06801357120275497, 0.07113569229841232, 0.0743224024772644, 0.07757321745157242, 0.08088764548301697, 0.08426519483327866, 0.0877053514122963, 0.0912075936794281, 0.09477140009403229, 0.09839623421430588, 0.1020815446972847, 0.10582678765058517, 0.10963138937950134, 0.11349477618932724, 0.1174163669347763, 0.12139558047056198, 0.12543180584907532, 0.12952443957328796, 0.13367286324501038, 0.1378764659166336, 0.14213459193706512, 0.1464466154575348, 0.15081188082695007, 0.15522973239421844, 0.15969949960708618, 0.16422052681446075, 0.16879211366176605, 0.17341357469558716, 0.17808422446250916, 0.18280336260795593, 0.187570258975029, 0.19238419830799103, 0.19724448025226593, 0.2021503448486328, 0.20710107684135437, 0.21209590137004852, 0.21713408827781677, 0.22221487760543823, 0.22733750939369202, 0.23250119388103485, 0.23770515620708466, 0.24294862151145935, 0.24823081493377686, 0.2535509169101715, 0.25890812277793884, 0.2643016278743744, 0.26973065733909607, 0.27519434690475464, 0.28069189190864563, 0.2862224578857422, 0.29178521037101746, 0.29737934470176697, 0.3030039668083191, 0.30865827202796936, 0.31434139609336853, 0.32005247473716736, 0.325790673494339, 0.3315550684928894, 0.33734485507011414, 0.34315913915634155, 0.3489970266819, 0.3548576533794403, 0.36074015498161316, 0.36664360761642456, 0.37256717681884766, 0.37850990891456604, 0.38447093963623047, 0.3904493749141693, 0.39644432067871094, 0.40245485305786133, 0.40848004817962646, 0.4145190417766571, 0.4205709397792816, 0.4266347587108612, 0.43270963430404663, 0.43879467248916626, 0.4448888897895813, 0.4509914219379425, 0.45710134506225586, 0.46321770548820496, 0.46933963894844055, 0.47546616196632385, 0.4815963804721832, 0.48772940039634705, 0.4938642382621765, 0.5, 0.5061357617378235, 0.5122706294059753, 0.5184035897254944, 0.5245338082313538, 0.5306603908538818, 0.5367822647094727, 0.5428986549377441, 0.5490085482597351, 0.5551111102104187, 0.5612053275108337, 0.5672903656959534, 0.5733652114868164, 0.5794290900230408, 0.5854809284210205, 0.5915199518203735, 0.5975451469421387, 0.6035556793212891, 0.6095505952835083, 0.6155290603637695, 0.6214900612831116, 0.6274328231811523, 0.6333563923835754, 0.6392598152160645, 0.6451423168182373, 0.6510030031204224, 0.6568408608436584, 0.6626551747322083, 0.6684449315071106, 0.6742093563079834, 0.6799474954605103, 0.6856585741043091, 0.6913416981697083, 0.6969960331916809, 0.7026206851005554, 0.7082147598266602, 0.7137775421142578, 0.7193081378936768, 0.7248056530952454, 0.7302693724632263, 0.7356983423233032, 0.7410919070243835, 0.7464491128921509, 0.7517691850662231, 0.7570513486862183, 0.7622948288917542, 0.767498791217804, 0.7726625204086304, 0.7777851223945618, 0.7828658819198608, 0.7879040837287903, 0.792898952960968, 0.7978496551513672, 0.8027555346488953, 0.8076158165931702, 0.8124297261238098, 0.8171966671943665, 0.8219157457351685, 0.8265864253044128, 0.8312078714370728, 0.8357794880867004, 0.8403005003929138, 0.8447702527046204, 0.8491881489753723, 0.8535534143447876, 0.8578653931617737, 0.8621235489845276, 0.8663271069526672, 0.8704755902290344, 0.8745682239532471, 0.8786044120788574, 0.8825836181640625, 0.8865052461624146, 0.890368640422821, 0.8941732048988342, 0.8979184627532959, 0.9016037583351135, 0.9052286148071289, 0.9087924361228943, 0.9122946262359619, 0.9157348275184631, 0.9191123247146606, 0.9224267601966858, 0.9256775975227356, 0.9288643002510071, 0.9319864511489868, 0.9350435137748718, 0.9380350708961487, 0.9409606456756592, 0.9438198208808899, 0.9466121792793274, 0.9493372440338135, 0.9519946575164795, 0.954584002494812, 0.9571048617362976, 0.9595569372177124, 0.9619397521018982, 0.9642530679702759, 0.9664964079856873, 0.9686695337295532, 0.9707720279693604, 0.9728036522865295, 0.9747641086578369, 0.9766530394554138, 0.9784701466560364, 0.9802152514457703, 0.9818880558013916, 0.9834882616996765, 0.9850156307220459, 0.9864699840545654, 0.987851083278656, 0.9891586899757385, 0.9903926253318787, 0.9915527701377869, 0.9926388263702393, 0.9936507344245911, 0.9945882558822632, 0.9954513311386108, 0.9962397813796997, 0.9969534873962402, 0.9975923895835876, 0.9981563091278076, 0.9986452460289001, 0.9990590810775757, 0.9993977546691895, 0.9996612071990967, 0.9998494386672974, 0.999962329864502, 1.0, 0.999962329864502, 0.9998494386672974, 0.9996612071990967, 0.9993977546691895, 0.9990590810775757, 0.9986452460289001, 0.9981563091278076, 0.9975923895835876, 0.9969534873962402, 0.9962397813796997, 0.9954513311386108, 0.9945882558822632, 0.9936507344245911, 0.9926388263702393, 0.9915527701377869, 0.9903926253318787, 0.9891586899757385, 0.987851083278656, 0.9864699840545654, 0.9850156307220459, 0.9834882616996765, 0.9818880558013916, 0.9802152514457703, 0.9784701466560364, 0.9766530394554138, 0.9747641086578369, 0.9728036522865295, 0.9707720279693604, 0.9686695337295532, 0.9664964079856873, 0.9642530679702759, 0.9619397521018982, 0.9595569372177124, 0.9571048617362976, 0.954584002494812, 0.9519946575164795, 0.9493372440338135, 0.9466121792793274, 0.9438198208808899, 0.9409606456756592, 0.9380350708961487, 0.9350435137748718, 0.9319864511489868, 0.9288643002510071, 0.9256775975227356, 0.9224267601966858, 0.9191123247146606, 0.9157348275184631, 0.9122946262359619, 0.9087924361228943, 0.9052286148071289, 0.9016037583351135, 0.8979184627532959, 0.8941732048988342, 0.890368640422821, 0.8865052461624146, 0.8825836181640625, 0.8786044120788574, 0.8745682239532471, 0.8704755902290344, 0.8663271069526672, 0.8621235489845276, 0.8578653931617737, 0.8535534143447876, 0.8491881489753723, 0.8447702527046204, 0.8403005003929138, 0.8357794880867004, 0.8312078714370728, 0.8265864253044128, 0.8219157457351685, 0.8171966671943665, 0.8124297261238098, 0.8076158165931702, 0.8027555346488953, 0.7978496551513672, 0.792898952960968, 0.7879040837287903, 0.7828658819198608, 0.7777851223945618, 0.7726625204086304, 0.767498791217804, 0.7622948288917542, 0.7570513486862183, 0.7517691850662231, 0.7464491128921509, 0.7410919070243835, 0.7356983423233032, 0.7302693724632263, 0.7248056530952454, 0.7193081378936768, 0.7137775421142578, 0.7082147598266602, 0.7026206851005554, 0.6969960331916809, 0.6913416981697083, 0.6856585741043091, 0.6799474954605103, 0.6742093563079834, 0.6684449315071106, 0.6626551747322083, 0.6568408608436584, 0.6510030031204224, 0.6451423168182373, 0.6392598152160645, 0.6333563923835754, 0.6274328231811523, 0.6214900612831116, 0.6155290603637695, 0.6095505952835083, 0.6035556793212891, 0.5975451469421387, 0.5915199518203735, 0.5854809284210205, 0.5794290900230408, 0.5733652114868164, 0.5672903656959534, 0.5612053275108337, 0.5551111102104187, 0.5490085482597351, 0.5428986549377441, 0.5367822647094727, 0.5306603908538818, 0.5245338082313538, 0.5184035897254944, 0.5122706294059753, 0.5061357617378235, 0.5, 0.4938642382621765, 0.48772940039634705, 0.4815963804721832, 0.47546616196632385, 0.46933963894844055, 0.46321770548820496, 0.45710134506225586, 0.4509914219379425, 0.4448888897895813, 0.43879467248916626, 0.43270963430404663, 0.4266347587108612, 0.4205709397792816, 0.4145190417766571, 0.40848004817962646, 0.40245485305786133, 0.39644432067871094, 0.3904493749141693, 0.38447093963623047, 0.37850990891456604, 0.37256717681884766, 0.36664360761642456, 0.36074015498161316, 0.3548576533794403, 0.3489970266819, 0.34315913915634155, 0.33734485507011414, 0.3315550684928894, 0.325790673494339, 0.32005247473716736, 0.31434139609336853, 0.30865827202796936, 0.3030039668083191, 0.29737934470176697, 0.29178521037101746, 0.2862224578857422, 0.28069189190864563, 0.27519434690475464, 0.26973065733909607, 0.2643016278743744, 0.25890812277793884, 0.2535509169101715, 0.24823081493377686, 0.24294862151145935, 0.23770515620708466, 0.23250119388103485, 0.22733750939369202, 0.22221487760543823, 0.21713408827781677, 0.21209590137004852, 0.20710107684135437, 0.2021503448486328, 0.19724448025226593, 0.19238419830799103, 0.187570258975029, 0.18280336260795593, 0.17808422446250916, 0.17341357469558716, 0.16879211366176605, 0.16422052681446075, 0.15969949960708618, 0.15522973239421844, 0.15081188082695007, 0.1464466154575348, 0.14213459193706512, 0.1378764659166336, 0.13367286324501038, 0.12952443957328796, 0.12543180584907532, 0.12139558047056198, 0.1174163669347763, 0.11349477618932724, 0.10963138937950134, 0.10582678765058517, 0.1020815446972847, 0.09839623421430588, 0.09477140009403229, 0.0912075936794281, 0.0877053514122963, 0.08426519483327866, 0.08088764548301697, 0.07757321745157242, 0.0743224024772644, 0.07113569229841232, 0.06801357120275497, 0.06495650112628937, 0.06196495145559311, 0.059039369225502014, 0.056180190294981, 0.053387850522994995, 0.05066276714205742, 0.0480053536593914, 0.045416008681058884, 0.0428951233625412, 0.04044307395815849, 0.03806023299694061, 0.03574695810675621, 0.03350359946489334, 0.03133049234747887, 0.02922796830534935, 0.027196336537599564, 0.025235909968614578, 0.023346979171037674, 0.02152983285486698, 0.01978474110364914, 0.01811196655035019, 0.016511764377355576, 0.0149843730032444, 0.013530024327337742, 0.012148935347795486, 0.010841314680874348, 0.009607359766960144, 0.008447255939245224, 0.007361178752034903, 0.00634929072111845, 0.005411745049059391, 0.004548682365566492, 0.003760232590138912, 0.003046514932066202, 0.0024076367262750864, 0.0018436938989907503, 0.0013547716662287712, 0.0009409435442648828, 0.0006022718735039234, 0.00033880770206451416, 0.00015059065481182188, 3.764907887671143e-05};
const float32_t WSUM[INPUT_BUFFER_SIZE] = {0.0, 1.4174532658728367e-09, 2.2677545175042724e-08, 1.1479065875619199e-07, 3.627314413279237e-07, 8.853747885950725e-07, 1.8354062376602087e-06, 3.399207116672187e-06, 5.796714503958356e-06, 9.28125336940866e-06, 1.4139350241748616e-05, 2.0690509700216353e-05, 2.9286984499776736e-05, 4.031349453725852e-05, 5.418695218395442e-05, 7.135613850550726e-05, 9.230136492988095e-05, 0.00011753410217352211, 0.00014759662735741585, 0.0001830615510698408, 0.00022453143901657313, 0.0002726383681874722, 0.00032804335933178663, 0.0003914359549526125, 0.0004635336808860302, 0.0005450814496725798, 0.0006368511239998043, 0.0007396407891064882, 0.0008542740833945572, 0.0009815999073907733, 0.0011224912013858557, 0.0012778451200574636, 0.00144858134444803, 0.0016356422565877438, 0.0018399915425106883, 0.002062613843008876, 0.0023045139387249947, 0.0025667159352451563, 0.0028502624481916428, 0.003156213788315654, 0.003485647030174732, 0.003839655313640833, 0.004219347611069679, 0.004625846166163683, 0.005060287192463875, 0.005523819476366043, 0.006017603911459446, 0.006542811635881662, 0.0071006231009960175, 0.0076922280713915825, 0.0083188246935606, 0.008981618098914623, 0.009681819006800652, 0.010420642793178558, 0.011199308559298515, 0.012019040994346142, 0.012881063856184483, 0.013786603696644306, 0.014736886136233807, 0.015733137726783752, 0.01677658036351204, 0.017868435010313988, 0.019009917974472046, 0.020202241837978363, 0.021446609869599342, 0.02274422161281109, 0.02409626916050911, 0.02550393156707287, 0.02696838043630123, 0.02849077619612217, 0.030072269961237907, 0.03171399235725403, 0.03341706842184067, 0.03518260270357132, 0.037011682987213135, 0.03890538588166237, 0.04086476191878319, 0.04289085417985916, 0.04498467221856117, 0.04714721441268921, 0.04937945306301117, 0.05168234184384346, 0.0540568046271801, 0.056503742933273315, 0.059024035930633545, 0.06161853298544884, 0.06428805738687515, 0.06703341007232666, 0.06985535472631454, 0.0727546215057373, 0.07573192566633224, 0.07878793030977249, 0.08192329108715057, 0.08513861149549484, 0.08843447268009186, 0.0918114110827446, 0.09526993334293365, 0.09881051629781723, 0.10243359208106995, 0.10613955557346344, 0.10992876440286636, 0.11380155384540558, 0.11775818467140198, 0.12179892510175705, 0.12592396140098572, 0.1301334649324417, 0.13442754745483398, 0.1388062983751297, 0.14326974749565125, 0.14781790971755981, 0.15245072543621063, 0.15716809034347534, 0.16196990013122559, 0.16685596108436584, 0.1718260496854782, 0.1768799126148224, 0.1820172220468521, 0.18723763525485992, 0.1925407499074936, 0.1979261338710785, 0.20339326560497284, 0.20894163846969604, 0.21457065641880035, 0.22027969360351562, 0.22606806457042694, 0.23193508386611938, 0.2378799468278885, 0.24390187859535217, 0.25, 0.25617340207099915, 0.262421190738678, 0.26874229311943054, 0.27513575553894043, 0.2816004157066345, 0.28813523054122925, 0.2947389483451843, 0.30141040682792664, 0.3081483244895935, 0.31495141983032227, 0.32181835174560547, 0.3287476897239685, 0.33573806285858154, 0.3427879214286804, 0.3498958349227905, 0.3570602238178253, 0.36427947878837585, 0.3715519607067108, 0.3788760304450989, 0.38624992966651917, 0.3936719596385956, 0.4011403024196625, 0.4086531400680542, 0.4162086248397827, 0.4238048791885376, 0.43143993616104126, 0.4391118288040161, 0.44681861996650696, 0.45455822348594666, 0.46232861280441284, 0.4701277017593384, 0.47795337438583374, 0.4858034551143646, 0.4936757981777191, 0.5015681982040405, 0.5094783902168274, 0.5174041986465454, 0.5253432393074036, 0.5332933068275452, 0.541252076625824, 0.549217164516449, 0.5571862459182739, 0.5651569366455078, 0.5731267929077148, 0.581093430519104, 0.5890544056892395, 0.5970073342323303, 0.6049497127532959, 0.6128790378570557, 0.6207928657531738, 0.6286886930465698, 0.6365640759468079, 0.6444164514541626, 0.6522432565689087, 0.6600421071052551, 0.6678103804588318, 0.6755455136299133, 0.6832451224327087, 0.6909065246582031, 0.6985273361206055, 0.7061049342155457, 0.7136368155479431, 0.7211204767227173, 0.7285534143447876, 0.7359330654144287, 0.7432569861412048, 0.7505227327346802, 0.7577276825904846, 0.7648695111274719, 0.7719457149505615, 0.7789538502693176, 0.7858915328979492, 0.7927562594413757, 0.7995457649230957, 0.8062575459480286, 0.8128893375396729, 0.8194388151168823, 0.8259036540985107, 0.8322815299034119, 0.838570237159729, 0.8447675108909607, 0.8508711457252502, 0.8568789958953857, 0.8627889156341553, 0.8685986995697021, 0.874306321144104, 0.8799097537994385, 0.8854069113731384, 0.8907958269119263, 0.8960745930671692, 0.9012411832809448, 0.9062938094139099, 0.9112306237220764, 0.9160497188568115, 0.9207494854927063, 0.9253281354904175, 0.9297839403152466, 0.9341152906417847, 0.9383206367492676, 0.9423983097076416, 0.9463469386100769, 0.9501650333404541, 0.9538511037826538, 0.9574038982391357, 0.9608219265937805, 0.9641041159629822, 0.9672490954399109, 0.9702557921409607, 0.9731230139732361, 0.9758497476577759, 0.9784349203109741, 0.9808775782585144, 0.9831768274307251, 0.9853318333625793, 0.9873417019844055, 0.9892057776451111, 0.9909233450889587, 0.9924936890602112, 0.9939162731170654, 0.9951905012130737, 0.9963160157203674, 0.9972922801971436, 0.9981189966201782, 0.9987958073616028, 0.9993224740028381, 0.99969881772995, 0.9999247193336487, 1.0, 0.9999247193336487, 0.9996988773345947, 0.9993225932121277, 0.9987961649894714, 0.9981198906898499, 0.9972941279411316, 0.9963194131851196, 0.9951963424682617, 0.9939255118370056, 0.992507815361023, 0.9909440279006958, 0.9892351031303406, 0.9873820543289185, 0.9853860139846802, 0.9832481741905212, 0.9809699058532715, 0.9785524606704712, 0.9759973287582397, 0.9733060598373413, 0.9704803228378296, 0.9675217270851135, 0.9644321799278259, 0.9612134099006653, 0.9578673839569092, 0.9543961882591248, 0.9508019089698792, 0.9470866322517395, 0.9432526230812073, 0.9393022060394287, 0.9352377653121948, 0.9310617446899414, 0.9267767071723938, 0.9223851561546326, 0.9178897142410278, 0.913293182849884, 0.9085983037948608, 0.9038078784942627, 0.8989248275756836, 0.8939520716667175, 0.8888925313949585, 0.8837494254112244, 0.8785256743431091, 0.8732245564460754, 0.8678491711616516, 0.8624028563499451, 0.8568887710571289, 0.8513103127479553, 0.8456708788871765, 0.8399737477302551, 0.8342224359512329, 0.8284204602241516, 0.8225711584091187, 0.8166781663894653, 0.8107450604438782, 0.8047752976417542, 0.7987725734710693, 0.7927404642105103, 0.7866826057434082, 0.7806026935577393, 0.7745043039321899, 0.7683911323547363, 0.7622669339179993, 0.7561352849006653, 0.75, 0.7438647150993347, 0.7377330660820007, 0.7316088676452637, 0.7254956960678101, 0.7193973064422607, 0.7133173942565918, 0.7072595357894897, 0.7012274265289307, 0.6952247023582458, 0.6892549395561218, 0.6833218336105347, 0.6774288415908813, 0.6715795397758484, 0.6657775640487671, 0.6600262522697449, 0.6543291211128235, 0.6486896872520447, 0.6431112289428711, 0.6375971436500549, 0.6321508288383484, 0.6267754435539246, 0.6214743256568909, 0.6162505745887756, 0.6111074686050415, 0.6060479283332825, 0.6010751724243164, 0.5961921215057373, 0.5914016962051392, 0.586706817150116, 0.5821102857589722, 0.5776148438453674, 0.5732232928276062, 0.5689382553100586, 0.5647622346878052, 0.5606977939605713, 0.5567473769187927, 0.5529133677482605, 0.5491980910301208, 0.5456038117408752, 0.5421326160430908, 0.5387865900993347, 0.5355678200721741, 0.5324782729148865, 0.5295196771621704, 0.5266939401626587, 0.5240026712417603, 0.5214475393295288, 0.5190300941467285, 0.5167518258094788, 0.5146139860153198, 0.5126179456710815, 0.5107648968696594, 0.5090559720993042, 0.507492184638977, 0.5060744881629944, 0.5048036575317383, 0.5036805868148804, 0.5027058720588684, 0.5018801093101501, 0.5012038350105286, 0.5006774067878723, 0.5003011226654053, 0.5000752806663513, 0.5, 0.5000752806663513, 0.5003011226654053, 0.5006774067878723, 0.5012038350105286, 0.5018801093101501, 0.5027058720588684, 0.5036805868148804, 0.5048036575317383, 0.5060744881629944, 0.507492184638977, 0.5090559720993042, 0.5107648968696594, 0.5126179456710815, 0.5146139860153198, 0.5167518258094788, 0.5190300941467285, 0.5214475393295288, 0.5240026712417603, 0.5266939401626587, 0.5295196771621704, 0.5324782729148865, 0.5355678200721741, 0.5387865900993347, 0.5421326160430908, 0.5456038117408752, 0.5491980910301208, 0.5529133677482605, 0.5567473769187927, 0.5606977939605713, 0.5647622346878052, 0.5689382553100586, 0.5732232928276062, 0.5776148438453674, 0.5821102857589722, 0.586706817150116, 0.5914016962051392, 0.5961921215057373, 0.6010751724243164, 0.6060479283332825, 0.6111074686050415, 0.6162505745887756, 0.6214743256568909, 0.6267754435539246, 0.6321508288383484, 0.6375971436500549, 0.6431112289428711, 0.6486896872520447, 0.6543291211128235, 0.6600262522697449, 0.6657775640487671, 0.6715795397758484, 0.6774288415908813, 0.6833218336105347, 0.6892549395561218, 0.6952247023582458, 0.7012274265289307, 0.7072595357894897, 0.7133173942565918, 0.7193973064422607, 0.7254956960678101, 0.7316088676452637, 0.7377330660820007, 0.7438647150993347, 0.75, 0.7561352849006653, 0.7622669339179993, 0.7683911323547363, 0.7745043039321899, 0.7806026935577393, 0.7866826057434082, 0.7927404642105103, 0.7987725734710693, 0.8047752976417542, 0.8107450604438782, 0.8166781663894653, 0.8225711584091187, 0.8284204602241516, 0.8342224359512329, 0.8399737477302551, 0.8456708788871765, 0.8513103127479553, 0.8568887710571289, 0.8624028563499451, 0.8678491711616516, 0.8732245564460754, 0.8785256743431091, 0.8837494254112244, 0.8888925313949585, 0.8939520716667175, 0.8989248275756836, 0.9038078784942627, 0.9085983037948608, 0.913293182849884, 0.9178897142410278, 0.9223851561546326, 0.9267767071723938, 0.9310617446899414, 0.9352377653121948, 0.9393022060394287, 0.9432526230812073, 0.9470866322517395, 0.9508019089698792, 0.9543961882591248, 0.9578673839569092, 0.9612134099006653, 0.9644321799278259, 0.9675217270851135, 0.9704803228378296, 0.9733060598373413, 0.9759973287582397, 0.9785524606704712, 0.9809699058532715, 0.9832481741905212, 0.9853860139846802, 0.9873820543289185, 0.9892351031303406, 0.9909440279006958, 0.992507815361023, 0.9939255118370056, 0.9951963424682617, 0.9963194131851196, 0.9972941279411316, 0.9981198906898499, 0.9987961649894714, 0.9993225932121277, 0.9996988773345947, 0.9999247193336487, 1.0, 0.9999247193336487, 0.9996988773345947, 0.9993225932121277, 0.9987961649894714, 0.9981198906898499, 0.9972941279411316, 0.9963194131851196, 0.9951963424682617, 0.9939255118370056, 0.992507815361023, 0.9909440279006958, 0.9892351031303406, 0.9873820543289185, 0.9853860139846802, 0.9832481741905212, 0.9809699058532715, 0.9785524606704712, 0.9759973287582397, 0.9733060598373413, 0.9704803228378296, 0.9675217270851135, 0.9644321799278259, 0.9612134099006653, 0.9578673839569092, 0.9543961882591248, 0.9508019089698792, 0.9470866322517395, 0.9432526230812073, 0.9393022060394287, 0.9352377653121948, 0.9310617446899414, 0.9267767071723938, 0.9223851561546326, 0.9178897142410278, 0.913293182849884, 0.9085983037948608, 0.9038078784942627, 0.8989248275756836, 0.8939520716667175, 0.8888925313949585, 0.8837494254112244, 0.8785256743431091, 0.8732245564460754, 0.8678491711616516, 0.8624028563499451, 0.8568887710571289, 0.8513103127479553, 0.8456708788871765, 0.8399737477302551, 0.8342224359512329, 0.8284204602241516, 0.8225711584091187, 0.8166781663894653, 0.8107450604438782, 0.8047752976417542, 0.7987725734710693, 0.7927404642105103, 0.7866826057434082, 0.7806026935577393, 0.7745043039321899, 0.7683911323547363, 0.7622669339179993, 0.7561352849006653, 0.75, 0.7438647150993347, 0.7377330660820007, 0.7316088676452637, 0.7254956960678101, 0.7193973064422607, 0.7133173942565918, 0.7072595357894897, 0.7012274265289307, 0.6952247023582458, 0.6892549395561218, 0.6833218336105347, 0.6774288415908813, 0.6715795397758484, 0.6657775640487671, 0.6600262522697449, 0.6543291211128235, 0.6486896872520447, 0.6431112289428711, 0.6375971436500549, 0.6321508288383484, 0.6267754435539246, 0.6214743256568909, 0.6162505745887756, 0.6111074686050415, 0.6060479283332825, 0.6010751724243164, 0.5961921215057373, 0.5914016962051392, 0.586706817150116, 0.5821102857589722, 0.5776148438453674, 0.5732232928276062, 0.5689382553100586, 0.5647622346878052, 0.5606977939605713, 0.5567473769187927, 0.5529133677482605, 0.5491980910301208, 0.5456038117408752, 0.5421326160430908, 0.5387865900993347, 0.5355678200721741, 0.5324782729148865, 0.5295196771621704, 0.5266939401626587, 0.5240026712417603, 0.5214475393295288, 0.5190300941467285, 0.5167518258094788, 0.5146139860153198, 0.5126179456710815, 0.5107648968696594, 0.5090559720993042, 0.507492184638977, 0.5060744881629944, 0.5048036575317383, 0.5036805868148804, 0.5027058720588684, 0.5018801093101501, 0.5012038350105286, 0.5006774067878723, 0.5003011226654053, 0.5000752806663513, 0.5, 0.5000752806663513, 0.5003011226654053, 0.5006774067878723, 0.5012038350105286, 0.5018801093101501, 0.5027058720588684, 0.5036805868148804, 0.5048036575317383, 0.5060744881629944, 0.507492184638977, 0.5090559720993042, 0.5107648968696594, 0.5126179456710815, 0.5146139860153198, 0.5167518258094788, 0.5190300941467285, 0.5214475393295288, 0.5240026712417603, 0.5266939401626587, 0.5295196771621704, 0.5324782729148865, 0.5355678200721741, 0.5387865900993347, 0.5421326160430908, 0.5456038117408752, 0.5491980910301208, 0.5529133677482605, 0.5567473769187927, 0.5606977939605713, 0.5647622346878052, 0.5689382553100586, 0.5732232928276062, 0.5776148438453674, 0.5821102857589722, 0.586706817150116, 0.5914016962051392, 0.5961921215057373, 0.6010751724243164, 0.6060479283332825, 0.6111074686050415, 0.6162505745887756, 0.6214743256568909, 0.6267754435539246, 0.6321508288383484, 0.6375971436500549, 0.6431112289428711, 0.6486896872520447, 0.6543291211128235, 0.6600262522697449, 0.6657775640487671, 0.6715795397758484, 0.6774288415908813, 0.6833218336105347, 0.6892549395561218, 0.6952247023582458, 0.7012274265289307, 0.7072595357894897, 0.7133173942565918, 0.7193973064422607, 0.7254956960678101, 0.7316088676452637, 0.7377330660820007, 0.7438647150993347, 0.75, 0.7561352849006653, 0.7622669339179993, 0.7683911323547363, 0.7745043039321899, 0.7806026935577393, 0.7866826057434082, 0.7927404642105103, 0.7987725734710693, 0.8047752976417542, 0.8107450604438782, 0.8166781663894653, 0.8225711584091187, 0.8284204602241516, 0.8342224359512329, 0.8399737477302551, 0.8456708788871765, 0.8513103127479553, 0.8568887710571289, 0.8624028563499451, 0.8678491711616516, 0.8732245564460754, 0.8785256743431091, 0.8837494254112244, 0.8888925313949585, 0.8939520716667175, 0.8989248275756836, 0.9038078784942627, 0.9085983037948608, 0.913293182849884, 0.9178897142410278, 0.9223851561546326, 0.9267767071723938, 0.9310617446899414, 0.9352377653121948, 0.9393022060394287, 0.9432526230812073, 0.9470866322517395, 0.9508019089698792, 0.9543961882591248, 0.9578673839569092, 0.9612134099006653, 0.9644321799278259, 0.9675217270851135, 0.9704803228378296, 0.9733060598373413, 0.9759973287582397, 0.9785524606704712, 0.9809699058532715, 0.9832481741905212, 0.9853860139846802, 0.9873820543289185, 0.9892351031303406, 0.9909440279006958, 0.992507815361023, 0.9939255118370056, 0.9951963424682617, 0.9963194131851196, 0.9972941279411316, 0.9981198906898499, 0.9987961649894714, 0.9993225932121277, 0.9996988773345947, 0.9999247193336487, 1.0, 0.9999247193336487, 0.9996988773345947, 0.9993225932121277, 0.9987961649894714, 0.9981198906898499, 0.9972941279411316, 0.9963194131851196, 0.9951963424682617, 0.9939255118370056, 0.992507815361023, 0.9909440279006958, 0.9892351031303406, 0.9873820543289185, 0.9853860139846802, 0.9832481741905212, 0.9809699058532715, 0.9785524606704712, 0.9759973287582397, 0.9733060598373413, 0.9704803228378296, 0.9675217270851135, 0.9644321799278259, 0.9612134099006653, 0.9578673839569092, 0.9543961882591248, 0.9508019089698792, 0.9470866322517395, 0.9432526230812073, 0.9393022060394287, 0.9352377653121948, 0.9310617446899414, 0.9267767071723938, 0.9223851561546326, 0.9178897142410278, 0.913293182849884, 0.9085983037948608, 0.9038078784942627, 0.8989248275756836, 0.8939520716667175, 0.8888925313949585, 0.8837494254112244, 0.8785256743431091, 0.8732245564460754, 0.8678491711616516, 0.8624028563499451, 0.8568887710571289, 0.8513103127479553, 0.8456708788871765, 0.8399737477302551, 0.8342224359512329, 0.8284204602241516, 0.8225711584091187, 0.8166781663894653, 0.8107450604438782, 0.8047752976417542, 0.7987725734710693, 0.7927404642105103, 0.7866826057434082, 0.7806026935577393, 0.7745043039321899, 0.7683911323547363, 0.7622669339179993, 0.7561352849006653, 0.75, 0.7438647150993347, 0.7377330660820007, 0.7316088676452637, 0.7254956960678101, 0.7193973064422607, 0.7133173942565918, 0.7072595357894897, 0.7012274265289307, 0.6952247023582458, 0.6892549395561218, 0.6833218336105347, 0.6774288415908813, 0.6715795397758484, 0.6657775640487671, 0.6600262522697449, 0.6543291211128235, 0.6486896872520447, 0.6431112289428711, 0.6375971436500549, 0.6321508288383484, 0.6267754435539246, 0.6214743256568909, 0.6162505745887756, 0.6111074686050415, 0.6060479283332825, 0.6010751724243164, 0.5961921215057373, 0.5914016962051392, 0.586706817150116, 0.5821102857589722, 0.5776148438453674, 0.5732232928276062, 0.5689382553100586, 0.5647622346878052, 0.5606977939605713, 0.5567473769187927, 0.5529133677482605, 0.5491980910301208, 0.5456038117408752, 0.5421326160430908, 0.5387865900993347, 0.5355678200721741, 0.5324782729148865, 0.5295196771621704, 0.5266939401626587, 0.5240026712417603, 0.5214475393295288, 0.5190300941467285, 0.5167518258094788, 0.5146139860153198, 0.5126179456710815, 0.5107648968696594, 0.5090559720993042, 0.507492184638977, 0.5060744881629944, 0.5048036575317383, 0.5036805868148804, 0.5027058720588684, 0.5018801093101501, 0.5012038350105286, 0.5006774067878723, 0.5003011226654053, 0.5000752806663513, 0.5, 0.5000752806663513, 0.5003011226654053, 0.5006774067878723, 0.5012038350105286, 0.5018801093101501, 0.5027058720588684, 0.5036805868148804, 0.5048036575317383, 0.5060744881629944, 0.507492184638977, 0.5090559720993042, 0.5107648968696594, 0.5126179456710815, 0.5146139860153198, 0.5167518258094788, 0.5190300941467285, 0.5214475393295288, 0.5240026712417603, 0.5266939401626587, 0.5295196771621704, 0.5324782729148865, 0.5355678200721741, 0.5387865900993347, 0.5421326160430908, 0.5456038117408752, 0.5491980910301208, 0.5529133677482605, 0.5567473769187927, 0.5606977939605713, 0.5647622346878052, 0.5689382553100586, 0.5732232928276062, 0.5776148438453674, 0.5821102857589722, 0.586706817150116, 0.5914016962051392, 0.5961921215057373, 0.6010751724243164, 0.6060479283332825, 0.6111074686050415, 0.6162505745887756, 0.6214743256568909, 0.6267754435539246, 0.6321508288383484, 0.6375971436500549, 0.6431112289428711, 0.6486896872520447, 0.6543291211128235, 0.6600262522697449, 0.6657775640487671, 0.6715795397758484, 0.6774288415908813, 0.6833218336105347, 0.6892549395561218, 0.6952247023582458, 0.7012274265289307, 0.7072595357894897, 0.7133173942565918, 0.7193973064422607, 0.7254956960678101, 0.7316088676452637, 0.7377330660820007, 0.7438647150993347, 0.75, 0.7561352849006653, 0.7622669339179993, 0.7683911323547363, 0.7745043039321899, 0.7806026935577393, 0.7866826057434082, 0.7927404642105103, 0.7987725734710693, 0.8047752976417542, 0.8107450604438782, 0.8166781663894653, 0.8225711584091187, 0.8284204602241516, 0.8342224359512329, 0.8399737477302551, 0.8456708788871765, 0.8513103127479553, 0.8568887710571289, 0.8624028563499451, 0.8678491711616516, 0.8732245564460754, 0.8785256743431091, 0.8837494254112244, 0.8888925313949585, 0.8939520716667175, 0.8989248275756836, 0.9038078784942627, 0.9085983037948608, 0.913293182849884, 0.9178897142410278, 0.9223851561546326, 0.9267767071723938, 0.9310617446899414, 0.9352377653121948, 0.9393022060394287, 0.9432526230812073, 0.9470866322517395, 0.9508019089698792, 0.9543961882591248, 0.9578673839569092, 0.9612134099006653, 0.9644321799278259, 0.9675217270851135, 0.9704803228378296, 0.9733060598373413, 0.9759973287582397, 0.9785524606704712, 0.9809699058532715, 0.9832481741905212, 0.9853860139846802, 0.9873820543289185, 0.9892351031303406, 0.9909440279006958, 0.992507815361023, 0.9939255118370056, 0.9951963424682617, 0.9963194131851196, 0.9972941279411316, 0.9981198906898499, 0.9987961649894714, 0.9993225932121277, 0.9996988773345947, 0.9999247193336487, 1.0, 0.9999247193336487, 0.9996988773345947, 0.9993225932121277, 0.9987961649894714, 0.9981198906898499, 0.9972941279411316, 0.9963194131851196, 0.9951963424682617, 0.9939255118370056, 0.992507815361023, 0.9909440279006958, 0.9892351031303406, 0.9873820543289185, 0.9853860139846802, 0.9832481741905212, 0.9809699058532715, 0.9785524606704712, 0.9759973287582397, 0.9733060598373413, 0.9704803228378296, 0.9675217270851135, 0.9644321799278259, 0.9612134099006653, 0.9578673839569092, 0.9543961882591248, 0.9508019089698792, 0.9470866322517395, 0.9432526230812073, 0.9393022060394287, 0.9352377653121948, 0.9310617446899414, 0.9267767071723938, 0.9223851561546326, 0.9178897142410278, 0.913293182849884, 0.9085983037948608, 0.9038078784942627, 0.8989248275756836, 0.8939520716667175, 0.8888925313949585, 0.8837494254112244, 0.8785256743431091, 0.8732245564460754, 0.8678491711616516, 0.8624028563499451, 0.8568887710571289, 0.8513103127479553, 0.8456708788871765, 0.8399737477302551, 0.8342224359512329, 0.8284204602241516, 0.8225711584091187, 0.8166781663894653, 0.8107450604438782, 0.8047752976417542, 0.7987725734710693, 0.7927404642105103, 0.7866826057434082, 0.7806026935577393, 0.7745043039321899, 0.7683911323547363, 0.7622669339179993, 0.7561352849006653, 0.75, 0.7438647150993347, 0.7377330660820007, 0.7316088676452637, 0.7254956960678101, 0.7193973064422607, 0.7133173942565918, 0.7072595357894897, 0.7012274265289307, 0.6952247023582458, 0.6892549395561218, 0.6833218336105347, 0.6774288415908813, 0.6715795397758484, 0.6657775640487671, 0.6600262522697449, 0.6543291211128235, 0.6486896872520447, 0.6431112289428711, 0.6375971436500549, 0.6321508288383484, 0.6267754435539246, 0.6214743256568909, 0.6162505745887756, 0.6111074686050415, 0.6060479283332825, 0.6010751724243164, 0.5961921215057373, 0.5914016962051392, 0.586706817150116, 0.5821102857589722, 0.5776148438453674, 0.5732232928276062, 0.5689382553100586, 0.5647622346878052, 0.5606977939605713, 0.5567473769187927, 0.5529133677482605, 0.5491980910301208, 0.5456038117408752, 0.5421326160430908, 0.5387865900993347, 0.5355678200721741, 0.5324782729148865, 0.5295196771621704, 0.5266939401626587, 0.5240026712417603, 0.5214475393295288, 0.5190300941467285, 0.5167518258094788, 0.5146139860153198, 0.5126179456710815, 0.5107648968696594, 0.5090559720993042, 0.507492184638977, 0.5060744881629944, 0.5048036575317383, 0.5036805868148804, 0.5027058720588684, 0.5018801093101501, 0.5012038350105286, 0.5006774067878723, 0.5003011226654053, 0.5000752806663513, 0.5, 0.5000752806663513, 0.5003011226654053, 0.5006774067878723, 0.5012038350105286, 0.5018801093101501, 0.5027058720588684, 0.5036805868148804, 0.5048036575317383, 0.5060744881629944, 0.507492184638977, 0.5090559720993042, 0.5107648968696594, 0.5126179456710815, 0.5146139860153198, 0.5167518258094788, 0.5190300941467285, 0.5214475393295288, 0.5240026712417603, 0.5266939401626587, 0.5295196771621704, 0.5324782729148865, 0.5355678200721741, 0.5387865900993347, 0.5421326160430908, 0.5456038117408752, 0.5491980910301208, 0.5529133677482605, 0.5567473769187927, 0.5606977939605713, 0.5647622346878052, 0.5689382553100586, 0.5732232928276062, 0.5776148438453674, 0.5821102857589722, 0.586706817150116, 0.5914016962051392, 0.5961921215057373, 0.6010751724243164, 0.6060479283332825, 0.6111074686050415, 0.6162505745887756, 0.6214743256568909, 0.6267754435539246, 0.6321508288383484, 0.6375971436500549, 0.6431112289428711, 0.6486896872520447, 0.6543291211128235, 0.6600262522697449, 0.6657775640487671, 0.6715795397758484, 0.6774288415908813, 0.6833218336105347, 0.6892549395561218, 0.6952247023582458, 0.7012274265289307, 0.7072595357894897, 0.7133173942565918, 0.7193973064422607, 0.7254956960678101, 0.7316088676452637, 0.7377330660820007, 0.7438647150993347, 0.75, 0.7561352849006653, 0.7622669339179993, 0.7683911323547363, 0.7745043039321899, 0.7806026935577393, 0.7866826057434082, 0.7927404642105103, 0.7987725734710693, 0.8047752976417542, 0.8107450604438782, 0.8166781663894653, 0.8225711584091187, 0.8284204602241516, 0.8342224359512329, 0.8399737477302551, 0.8456708788871765, 0.8513103127479553, 0.8568887710571289, 0.8624028563499451, 0.8678491711616516, 0.8732245564460754, 0.8785256743431091, 0.8837494254112244, 0.8888925313949585, 0.8939520716667175, 0.8989248275756836, 0.9038078784942627, 0.9085983037948608, 0.913293182849884, 0.9178897142410278, 0.9223851561546326, 0.9267767071723938, 0.9310617446899414, 0.9352377653121948, 0.9393022060394287, 0.9432526230812073, 0.9470866322517395, 0.9508019089698792, 0.9543961882591248, 0.9578673839569092, 0.9612134099006653, 0.9644321799278259, 0.9675217270851135, 0.9704803228378296, 0.9733060598373413, 0.9759973287582397, 0.9785524606704712, 0.9809699058532715, 0.9832481741905212, 0.9853860139846802, 0.9873820543289185, 0.9892351031303406, 0.9909440279006958, 0.992507815361023, 0.9939255118370056, 0.9951963424682617, 0.9963194131851196, 0.9972941279411316, 0.9981198906898499, 0.9987961649894714, 0.9993225932121277, 0.9996988773345947, 0.9999247193336487, 1.0, 0.9999247193336487, 0.9996988773345947, 0.9993225932121277, 0.9987961649894714, 0.9981198906898499, 0.9972941279411316, 0.9963194131851196, 0.9951963424682617, 0.9939255118370056, 0.992507815361023, 0.9909440279006958, 0.9892351031303406, 0.9873820543289185, 0.9853860139846802, 0.9832481741905212, 0.9809699058532715, 0.9785524606704712, 0.9759973287582397, 0.9733060598373413, 0.9704803228378296, 0.9675217270851135, 0.9644321799278259, 0.9612134099006653, 0.9578673839569092, 0.9543961882591248, 0.9508019089698792, 0.9470866322517395, 0.9432526230812073, 0.9393022060394287, 0.9352377653121948, 0.9310617446899414, 0.9267767071723938, 0.9223851561546326, 0.9178897142410278, 0.913293182849884, 0.9085983037948608, 0.9038078784942627, 0.8989248275756836, 0.8939520716667175, 0.8888925313949585, 0.8837494254112244, 0.8785256743431091, 0.8732245564460754, 0.8678491711616516, 0.8624028563499451, 0.8568887710571289, 0.8513103127479553, 0.8456708788871765, 0.8399737477302551, 0.8342224359512329, 0.8284204602241516, 0.8225711584091187, 0.8166781663894653, 0.8107450604438782, 0.8047752976417542, 0.7987725734710693, 0.7927404642105103, 0.7866826057434082, 0.7806026935577393, 0.7745043039321899, 0.7683911323547363, 0.7622669339179993, 0.7561352849006653, 0.75, 0.7438647150993347, 0.7377330660820007, 0.7316088676452637, 0.7254956960678101, 0.7193973064422607, 0.7133173942565918, 0.7072595357894897, 0.7012274265289307, 0.6952247023582458, 0.6892549395561218, 0.6833218336105347, 0.6774288415908813, 0.6715795397758484, 0.6657775640487671, 0.6600262522697449, 0.6543291211128235, 0.6486896872520447, 0.6431112289428711, 0.6375971436500549, 0.6321508288383484, 0.6267754435539246, 0.6214743256568909, 0.6162505745887756, 0.6111074686050415, 0.6060479283332825, 0.6010751724243164, 0.5961921215057373, 0.5914016962051392, 0.586706817150116, 0.5821102857589722, 0.5776148438453674, 0.5732232928276062, 0.5689382553100586, 0.5647622346878052, 0.5606977939605713, 0.5567473769187927, 0.5529133677482605, 0.5491980910301208, 0.5456038117408752, 0.5421326160430908, 0.5387865900993347, 0.5355678200721741, 0.5324782729148865, 0.5295196771621704, 0.5266939401626587, 0.5240026712417603, 0.5214475393295288, 0.5190300941467285, 0.5167518258094788, 0.5146139860153198, 0.5126179456710815, 0.5107648968696594, 0.5090559720993042, 0.507492184638977, 0.5060744881629944, 0.5048036575317383, 0.5036805868148804, 0.5027058720588684, 0.5018801093101501, 0.5012038350105286, 0.5006774067878723, 0.5003011226654053, 0.5000752806663513, 0.5, 0.5000752806663513, 0.5003011226654053, 0.5006774067878723, 0.5012038350105286, 0.5018801093101501, 0.5027058720588684, 0.5036805868148804, 0.5048036575317383, 0.5060744881629944, 0.507492184638977, 0.5090559720993042, 0.5107648968696594, 0.5126179456710815, 0.5146139860153198, 0.5167518258094788, 0.5190300941467285, 0.5214475393295288, 0.5240026712417603, 0.5266939401626587, 0.5295196771621704, 0.5324782729148865, 0.5355678200721741, 0.5387865900993347, 0.5421326160430908, 0.5456038117408752, 0.5491980910301208, 0.5529133677482605, 0.5567473769187927, 0.5606977939605713, 0.5647622346878052, 0.5689382553100586, 0.5732232928276062, 0.5776148438453674, 0.5821102857589722, 0.586706817150116, 0.5914016962051392, 0.5961921215057373, 0.6010751724243164, 0.6060479283332825, 0.6111074686050415, 0.6162505745887756, 0.6214743256568909, 0.6267754435539246, 0.6321508288383484, 0.6375971436500549, 0.6431112289428711, 0.6486896872520447, 0.6543291211128235, 0.6600262522697449, 0.6657775640487671, 0.6715795397758484, 0.6774288415908813, 0.6833218336105347, 0.6892549395561218, 0.6952247023582458, 0.7012274265289307, 0.7072595357894897, 0.7133173942565918, 0.7193973064422607, 0.7254956960678101, 0.7316088676452637, 0.7377330660820007, 0.7438647150993347, 0.75, 0.7561352849006653, 0.7622669339179993, 0.7683911323547363, 0.7745043039321899, 0.7806026935577393, 0.7866826057434082, 0.7927404642105103, 0.7987725734710693, 0.8047752976417542, 0.8107450604438782, 0.8166781663894653, 0.8225711584091187, 0.8284204602241516, 0.8342224359512329, 0.8399737477302551, 0.8456708788871765, 0.8513103127479553, 0.8568887710571289, 0.8624028563499451, 0.8678491711616516, 0.8732245564460754, 0.8785256743431091, 0.8837494254112244, 0.8888925313949585, 0.8939520716667175, 0.8989248275756836, 0.9038078784942627, 0.9085983037948608, 0.913293182849884, 0.9178897142410278, 0.9223851561546326, 0.9267767071723938, 0.9310617446899414, 0.9352377653121948, 0.9393022060394287, 0.9432526230812073, 0.9470866322517395, 0.9508019089698792, 0.9543961882591248, 0.9578673839569092, 0.9612134099006653, 0.9644321799278259, 0.9675217270851135, 0.9704803228378296, 0.9733060598373413, 0.9759973287582397, 0.9785524606704712, 0.9809699058532715, 0.9832481741905212, 0.9853860139846802, 0.9873820543289185, 0.9892351031303406, 0.9909440279006958, 0.992507815361023, 0.9939255118370056, 0.9951963424682617, 0.9963194131851196, 0.9972941279411316, 0.9981198906898499, 0.9987961649894714, 0.9993225932121277, 0.9996988773345947, 0.9999247193336487, 1.0, 0.9999247193336487, 0.9996988773345947, 0.9993225932121277, 0.9987961649894714, 0.9981198906898499, 0.9972941279411316, 0.9963194131851196, 0.9951963424682617, 0.9939255118370056, 0.992507815361023, 0.9909440279006958, 0.9892351031303406, 0.9873820543289185, 0.9853860139846802, 0.9832481741905212, 0.9809699058532715, 0.9785524606704712, 0.9759973287582397, 0.9733060598373413, 0.9704803228378296, 0.9675217270851135, 0.9644321799278259, 0.9612134099006653, 0.9578673839569092, 0.9543961882591248, 0.9508019089698792, 0.9470866322517395, 0.9432526230812073, 0.9393022060394287, 0.9352377653121948, 0.9310617446899414, 0.9267767071723938, 0.9223851561546326, 0.9178897142410278, 0.913293182849884, 0.9085983037948608, 0.9038078784942627, 0.8989248275756836, 0.8939520716667175, 0.8888925313949585, 0.8837494254112244, 0.8785256743431091, 0.8732245564460754, 0.8678491711616516, 0.8624028563499451, 0.8568887710571289, 0.8513103127479553, 0.8456708788871765, 0.8399737477302551, 0.8342224359512329, 0.8284204602241516, 0.8225711584091187, 0.8166781663894653, 0.8107450604438782, 0.8047752976417542, 0.7987725734710693, 0.7927404642105103, 0.7866826057434082, 0.7806026935577393, 0.7745043039321899, 0.7683911323547363, 0.7622669339179993, 0.7561352849006653, 0.75, 0.7438647150993347, 0.7377330660820007, 0.7316088676452637, 0.7254956960678101, 0.7193973064422607, 0.7133173942565918, 0.7072595357894897, 0.7012274265289307, 0.6952247023582458, 0.6892549395561218, 0.6833218336105347, 0.6774288415908813, 0.6715795397758484, 0.6657775640487671, 0.6600262522697449, 0.6543291211128235, 0.6486896872520447, 0.6431112289428711, 0.6375971436500549, 0.6321508288383484, 0.6267754435539246, 0.6214743256568909, 0.6162505745887756, 0.6111074686050415, 0.6060479283332825, 0.6010751724243164, 0.5961921215057373, 0.5914016962051392, 0.586706817150116, 0.5821102857589722, 0.5776148438453674, 0.5732232928276062, 0.5689382553100586, 0.5647622346878052, 0.5606977939605713, 0.5567473769187927, 0.5529133677482605, 0.5491980910301208, 0.5456038117408752, 0.5421326160430908, 0.5387865900993347, 0.5355678200721741, 0.5324782729148865, 0.5295196771621704, 0.5266939401626587, 0.5240026712417603, 0.5214475393295288, 0.5190300941467285, 0.5167518258094788, 0.5146139860153198, 0.5126179456710815, 0.5107648968696594, 0.5090559720993042, 0.507492184638977, 0.5060744881629944, 0.5048036575317383, 0.5036805868148804, 0.5027058720588684, 0.5018801093101501, 0.5012038350105286, 0.5006774067878723, 0.5003011226654053, 0.5000752806663513, 0.5, 0.5000752806663513, 0.5003011226654053, 0.5006774067878723, 0.5012038350105286, 0.5018801093101501, 0.5027058720588684, 0.5036805868148804, 0.5048036575317383, 0.5060744881629944, 0.507492184638977, 0.5090559720993042, 0.5107648968696594, 0.5126179456710815, 0.5146139860153198, 0.5167518258094788, 0.5190300941467285, 0.5214475393295288, 0.5240026712417603, 0.5266939401626587, 0.5295196771621704, 0.5324782729148865, 0.5355678200721741, 0.5387865900993347, 0.5421326160430908, 0.5456038117408752, 0.5491980910301208, 0.5529133677482605, 0.5567473769187927, 0.5606977939605713, 0.5647622346878052, 0.5689382553100586, 0.5732232928276062, 0.5776148438453674, 0.5821102857589722, 0.586706817150116, 0.5914016962051392, 0.5961921215057373, 0.6010751724243164, 0.6060479283332825, 0.6111074686050415, 0.6162505745887756, 0.6214743256568909, 0.6267754435539246, 0.6321508288383484, 0.6375971436500549, 0.6431112289428711, 0.6486896872520447, 0.6543291211128235, 0.6600262522697449, 0.6657775640487671, 0.6715795397758484, 0.6774288415908813, 0.6833218336105347, 0.6892549395561218, 0.6952247023582458, 0.7012274265289307, 0.7072595357894897, 0.7133173942565918, 0.7193973064422607, 0.7254956960678101, 0.7316088676452637, 0.7377330660820007, 0.7438647150993347, 0.75, 0.7561352849006653, 0.7622669339179993, 0.7683911323547363, 0.7745043039321899, 0.7806026935577393, 0.7866826057434082, 0.7927404642105103, 0.7987725734710693, 0.8047752976417542, 0.8107450604438782, 0.8166781663894653, 0.8225711584091187, 0.8284204602241516, 0.8342224359512329, 0.8399737477302551, 0.8456708788871765, 0.8513103127479553, 0.8568887710571289, 0.8624028563499451, 0.8678491711616516, 0.8732245564460754, 0.8785256743431091, 0.8837494254112244, 0.8888925313949585, 0.8939520716667175, 0.8989248275756836, 0.9038078784942627, 0.9085983037948608, 0.913293182849884, 0.9178897142410278, 0.9223851561546326, 0.9267767071723938, 0.9310617446899414, 0.9352377653121948, 0.9393022060394287, 0.9432526230812073, 0.9470866322517395, 0.9508019089698792, 0.9543961882591248, 0.9578673839569092, 0.9612134099006653, 0.9644321799278259, 0.9675217270851135, 0.9704803228378296, 0.9733060598373413, 0.9759973287582397, 0.9785524606704712, 0.9809699058532715, 0.9832481741905212, 0.9853860139846802, 0.9873820543289185, 0.9892351031303406, 0.9909440279006958, 0.992507815361023, 0.9939255118370056, 0.9951963424682617, 0.9963194131851196, 0.9972941279411316, 0.9981198906898499, 0.9987961649894714, 0.9993225932121277, 0.9996988773345947, 0.9999247193336487, 1.0, 0.9999247193336487, 0.9996988773345947, 0.9993225932121277, 0.9987961649894714, 0.9981198906898499, 0.9972941279411316, 0.9963194131851196, 0.9951963424682617, 0.9939255118370056, 0.992507815361023, 0.9909440279006958, 0.9892351031303406, 0.9873820543289185, 0.9853860139846802, 0.9832481741905212, 0.9809699058532715, 0.9785524606704712, 0.9759973287582397, 0.9733060598373413, 0.9704803228378296, 0.9675217270851135, 0.9644321799278259, 0.9612134099006653, 0.9578673839569092, 0.9543961882591248, 0.9508019089698792, 0.9470866322517395, 0.9432526230812073, 0.9393022060394287, 0.9352377653121948, 0.9310617446899414, 0.9267767071723938, 0.9223851561546326, 0.9178897142410278, 0.913293182849884, 0.9085983037948608, 0.9038078784942627, 0.8989248275756836, 0.8939520716667175, 0.8888925313949585, 0.8837494254112244, 0.8785256743431091, 0.8732245564460754, 0.8678491711616516, 0.8624028563499451, 0.8568887710571289, 0.8513103127479553, 0.8456708788871765, 0.8399737477302551, 0.8342224359512329, 0.8284204602241516, 0.8225711584091187, 0.8166781663894653, 0.8107450604438782, 0.8047752976417542, 0.7987725734710693, 0.7927404642105103, 0.7866826057434082, 0.7806026935577393, 0.7745043039321899, 0.7683911323547363, 0.7622669339179993, 0.7561352849006653, 0.75, 0.7438647150993347, 0.7377330660820007, 0.7316088676452637, 0.7254956960678101, 0.7193973064422607, 0.7133173942565918, 0.7072595357894897, 0.7012274265289307, 0.6952247023582458, 0.6892549395561218, 0.6833218336105347, 0.6774288415908813, 0.6715795397758484, 0.6657775640487671, 0.6600262522697449, 0.6543291211128235, 0.6486896872520447, 0.6431112289428711, 0.6375971436500549, 0.6321508288383484, 0.6267754435539246, 0.6214743256568909, 0.6162505745887756, 0.6111074686050415, 0.6060479283332825, 0.6010751724243164, 0.5961921215057373, 0.5914016962051392, 0.586706817150116, 0.5821102857589722, 0.5776148438453674, 0.5732232928276062, 0.5689382553100586, 0.5647622346878052, 0.5606977939605713, 0.5567473769187927, 0.5529133677482605, 0.5491980910301208, 0.5456038117408752, 0.5421326160430908, 0.5387865900993347, 0.5355678200721741, 0.5324782729148865, 0.5295196771621704, 0.5266939401626587, 0.5240026712417603, 0.5214475393295288, 0.5190300941467285, 0.5167518258094788, 0.5146139860153198, 0.5126179456710815, 0.5107648968696594, 0.5090559720993042, 0.507492184638977, 0.5060744881629944, 0.5048036575317383, 0.5036805868148804, 0.5027058720588684, 0.5018801093101501, 0.5012038350105286, 0.5006774067878723, 0.5003011226654053, 0.5000752806663513, 0.5, 0.5000752806663513, 0.5003011226654053, 0.5006774067878723, 0.5012038350105286, 0.5018801093101501, 0.5027058720588684, 0.5036805868148804, 0.5048036575317383, 0.5060744881629944, 0.507492184638977, 0.5090559720993042, 0.5107648968696594, 0.5126179456710815, 0.5146139860153198, 0.5167518258094788, 0.5190300941467285, 0.5214475393295288, 0.5240026712417603, 0.5266939401626587, 0.5295196771621704, 0.5324782729148865, 0.5355678200721741, 0.5387865900993347, 0.5421326160430908, 0.5456038117408752, 0.5491980910301208, 0.5529133677482605, 0.5567473769187927, 0.5606977939605713, 0.5647622346878052, 0.5689382553100586, 0.5732232928276062, 0.5776148438453674, 0.5821102857589722, 0.586706817150116, 0.5914016962051392, 0.5961921215057373, 0.6010751724243164, 0.6060479283332825, 0.6111074686050415, 0.6162505745887756, 0.6214743256568909, 0.6267754435539246, 0.6321508288383484, 0.6375971436500549, 0.6431112289428711, 0.6486896872520447, 0.6543291211128235, 0.6600262522697449, 0.6657775640487671, 0.6715795397758484, 0.6774288415908813, 0.6833218336105347, 0.6892549395561218, 0.6952247023582458, 0.7012274265289307, 0.7072595357894897, 0.7133173942565918, 0.7193973064422607, 0.7254956960678101, 0.7316088676452637, 0.7377330660820007, 0.7438647150993347, 0.75, 0.7561352849006653, 0.7622669339179993, 0.7683911323547363, 0.7745043039321899, 0.7806026935577393, 0.7866826057434082, 0.7927404642105103, 0.7987725734710693, 0.8047752976417542, 0.8107450604438782, 0.8166781663894653, 0.8225711584091187, 0.8284204602241516, 0.8342224359512329, 0.8399737477302551, 0.8456708788871765, 0.8513103127479553, 0.8568887710571289, 0.8624028563499451, 0.8678491711616516, 0.8732245564460754, 0.8785256743431091, 0.8837494254112244, 0.8888925313949585, 0.8939520716667175, 0.8989248275756836, 0.9038078784942627, 0.9085983037948608, 0.913293182849884, 0.9178897142410278, 0.9223851561546326, 0.9267767071723938, 0.9310617446899414, 0.9352377653121948, 0.9393022060394287, 0.9432526230812073, 0.9470866322517395, 0.9508019089698792, 0.9543961882591248, 0.9578673839569092, 0.9612134099006653, 0.9644321799278259, 0.9675217270851135, 0.9704803228378296, 0.9733060598373413, 0.9759973287582397, 0.9785524606704712, 0.9809699058532715, 0.9832481741905212, 0.9853860139846802, 0.9873820543289185, 0.9892351031303406, 0.9909440279006958, 0.992507815361023, 0.9939255118370056, 0.9951963424682617, 0.9963194131851196, 0.9972941279411316, 0.9981198906898499, 0.9987961649894714, 0.9993225932121277, 0.9996988773345947, 0.9999247193336487, 1.0, 0.9999247193336487, 0.9996988773345947, 0.9993225932121277, 0.9987961649894714, 0.9981198906898499, 0.9972941279411316, 0.9963194131851196, 0.9951963424682617, 0.9939255118370056, 0.992507815361023, 0.9909440279006958, 0.9892351031303406, 0.9873820543289185, 0.9853860139846802, 0.9832481741905212, 0.9809699058532715, 0.9785524606704712, 0.9759973287582397, 0.9733060598373413, 0.9704803228378296, 0.9675217270851135, 0.9644321799278259, 0.9612134099006653, 0.9578673839569092, 0.9543961882591248, 0.9508019089698792, 0.9470866322517395, 0.9432526230812073, 0.9393022060394287, 0.9352377653121948, 0.9310617446899414, 0.9267767071723938, 0.9223851561546326, 0.9178897142410278, 0.913293182849884, 0.9085983037948608, 0.9038078784942627, 0.8989248275756836, 0.8939520716667175, 0.8888925313949585, 0.8837494254112244, 0.8785256743431091, 0.8732245564460754, 0.8678491711616516, 0.8624028563499451, 0.8568887710571289, 0.8513103127479553, 0.8456708788871765, 0.8399737477302551, 0.8342224359512329, 0.8284204602241516, 0.8225711584091187, 0.8166781663894653, 0.8107450604438782, 0.8047752976417542, 0.7987725734710693, 0.7927404642105103, 0.7866826057434082, 0.7806026935577393, 0.7745043039321899, 0.7683911323547363, 0.7622669339179993, 0.7561352849006653, 0.75, 0.7438647150993347, 0.7377330660820007, 0.7316088676452637, 0.7254956960678101, 0.7193973064422607, 0.7133173942565918, 0.7072595357894897, 0.7012274265289307, 0.6952247023582458, 0.6892549395561218, 0.6833218336105347, 0.6774288415908813, 0.6715795397758484, 0.6657775640487671, 0.6600262522697449, 0.6543291211128235, 0.6486896872520447, 0.6431112289428711, 0.6375971436500549, 0.6321508288383484, 0.6267754435539246, 0.6214743256568909, 0.6162505745887756, 0.6111074686050415, 0.6060479283332825, 0.6010751724243164, 0.5961921215057373, 0.5914016962051392, 0.586706817150116, 0.5821102857589722, 0.5776148438453674, 0.5732232928276062, 0.5689382553100586, 0.5647622346878052, 0.5606977939605713, 0.5567473769187927, 0.5529133677482605, 0.5491980910301208, 0.5456038117408752, 0.5421326160430908, 0.5387865900993347, 0.5355678200721741, 0.5324782729148865, 0.5295196771621704, 0.5266939401626587, 0.5240026712417603, 0.5214475393295288, 0.5190300941467285, 0.5167518258094788, 0.5146139860153198, 0.5126179456710815, 0.5107648968696594, 0.5090559720993042, 0.507492184638977, 0.5060744881629944, 0.5048036575317383, 0.5036805868148804, 0.5027058720588684, 0.5018801093101501, 0.5012038350105286, 0.5006774067878723, 0.5003011226654053, 0.5000752806663513, 0.5, 0.5000752806663513, 0.5003011226654053, 0.5006774067878723, 0.5012038350105286, 0.5018801093101501, 0.5027058720588684, 0.5036805868148804, 0.5048036575317383, 0.5060744881629944, 0.507492184638977, 0.5090559720993042, 0.5107648968696594, 0.5126179456710815, 0.5146139860153198, 0.5167518258094788, 0.5190300941467285, 0.5214475393295288, 0.5240026712417603, 0.5266939401626587, 0.5295196771621704, 0.5324782729148865, 0.5355678200721741, 0.5387865900993347, 0.5421326160430908, 0.5456038117408752, 0.5491980910301208, 0.5529133677482605, 0.5567473769187927, 0.5606977939605713, 0.5647622346878052, 0.5689382553100586, 0.5732232928276062, 0.5776148438453674, 0.5821102857589722, 0.586706817150116, 0.5914016962051392, 0.5961921215057373, 0.6010751724243164, 0.6060479283332825, 0.6111074686050415, 0.6162505745887756, 0.6214743256568909, 0.6267754435539246, 0.6321508288383484, 0.6375971436500549, 0.6431112289428711, 0.6486896872520447, 0.6543291211128235, 0.6600262522697449, 0.6657775640487671, 0.6715795397758484, 0.6774288415908813, 0.6833218336105347, 0.6892549395561218, 0.6952247023582458, 0.7012274265289307, 0.7072595357894897, 0.7133173942565918, 0.7193973064422607, 0.7254956960678101, 0.7316088676452637, 0.7377330660820007, 0.7438647150993347, 0.75, 0.7561352849006653, 0.7622669339179993, 0.7683911323547363, 0.7745043039321899, 0.7806026935577393, 0.7866826057434082, 0.7927404642105103, 0.7987725734710693, 0.8047752976417542, 0.8107450604438782, 0.8166781663894653, 0.8225711584091187, 0.8284204602241516, 0.8342224359512329, 0.8399737477302551, 0.8456708788871765, 0.8513103127479553, 0.8568887710571289, 0.8624028563499451, 0.8678491711616516, 0.8732245564460754, 0.8785256743431091, 0.8837494254112244, 0.8888925313949585, 0.8939520716667175, 0.8989248275756836, 0.9038078784942627, 0.9085983037948608, 0.913293182849884, 0.9178897142410278, 0.9223851561546326, 0.9267767071723938, 0.9310617446899414, 0.9352377653121948, 0.9393022060394287, 0.9432526230812073, 0.9470866322517395, 0.9508019089698792, 0.9543961882591248, 0.9578673839569092, 0.9612134099006653, 0.9644321799278259, 0.9675217270851135, 0.9704803228378296, 0.9733060598373413, 0.9759973287582397, 0.9785524606704712, 0.9809699058532715, 0.9832481741905212, 0.9853860139846802, 0.9873820543289185, 0.9892351031303406, 0.9909440279006958, 0.992507815361023, 0.9939255118370056, 0.9951963424682617, 0.9963194131851196, 0.9972941279411316, 0.9981198906898499, 0.9987961649894714, 0.9993225932121277, 0.9996988773345947, 0.9999247193336487, 1.0, 0.9999247193336487, 0.99969881772995, 0.9993224740028381, 0.9987958073616028, 0.9981189966201782, 0.9972922801971436, 0.9963160157203674, 0.9951905012130737, 0.9939162731170654, 0.9924936890602112, 0.9909233450889587, 0.9892057776451111, 0.9873417019844055, 0.9853318333625793, 0.9831768274307251, 0.9808775782585144, 0.9784349203109741, 0.9758497476577759, 0.9731230139732361, 0.9702557921409607, 0.9672490954399109, 0.9641041159629822, 0.9608219265937805, 0.9574038982391357, 0.9538511037826538, 0.9501650333404541, 0.9463469386100769, 0.9423983097076416, 0.9383206367492676, 0.9341152906417847, 0.9297839403152466, 0.9253281354904175, 0.9207494854927063, 0.9160497188568115, 0.9112306237220764, 0.9062938094139099, 0.9012411832809448, 0.8960745930671692, 0.8907958269119263, 0.8854069113731384, 0.8799097537994385, 0.874306321144104, 0.8685986995697021, 0.8627889156341553, 0.8568789958953857, 0.8508711457252502, 0.8447675108909607, 0.838570237159729, 0.8322815299034119, 0.8259036540985107, 0.8194388151168823, 0.8128893375396729, 0.8062575459480286, 0.7995457649230957, 0.7927562594413757, 0.7858915328979492, 0.7789538502693176, 0.7719457149505615, 0.7648695111274719, 0.7577276825904846, 0.7505227327346802, 0.7432569861412048, 0.7359330654144287, 0.7285534143447876, 0.7211204767227173, 0.7136368155479431, 0.7061049342155457, 0.6985273361206055, 0.6909065246582031, 0.6832451224327087, 0.6755455136299133, 0.6678103804588318, 0.6600421071052551, 0.6522432565689087, 0.6444164514541626, 0.6365640759468079, 0.6286886930465698, 0.6207928657531738, 0.6128790378570557, 0.6049497127532959, 0.5970073342323303, 0.5890544056892395, 0.581093430519104, 0.5731267929077148, 0.5651569366455078, 0.5571862459182739, 0.549217164516449, 0.541252076625824, 0.5332933068275452, 0.5253432393074036, 0.5174041986465454, 0.5094783902168274, 0.5015681982040405, 0.4936757981777191, 0.4858034551143646, 0.47795337438583374, 0.4701277017593384, 0.46232861280441284, 0.45455822348594666, 0.44681861996650696, 0.4391118288040161, 0.43143993616104126, 0.4238048791885376, 0.4162086248397827, 0.4086531400680542, 0.4011403024196625, 0.3936719596385956, 0.38624992966651917, 0.3788760304450989, 0.3715519607067108, 0.36427947878837585, 0.3570602238178253, 0.3498958349227905, 0.3427879214286804, 0.33573806285858154, 0.3287476897239685, 0.32181835174560547, 0.31495141983032227, 0.3081483244895935, 0.30141040682792664, 0.2947389483451843, 0.28813523054122925, 0.2816004157066345, 0.27513575553894043, 0.26874229311943054, 0.262421190738678, 0.25617340207099915, 0.25, 0.24390187859535217, 0.2378799468278885, 0.23193508386611938, 0.22606806457042694, 0.22027969360351562, 0.21457065641880035, 0.20894163846969604, 0.20339326560497284, 0.1979261338710785, 0.1925407499074936, 0.18723763525485992, 0.1820172220468521, 0.1768799126148224, 0.1718260496854782, 0.16685596108436584, 0.16196990013122559, 0.15716809034347534, 0.15245072543621063, 0.14781790971755981, 0.14326974749565125, 0.1388062983751297, 0.13442754745483398, 0.1301334649324417, 0.12592396140098572, 0.12179892510175705, 0.11775818467140198, 0.11380155384540558, 0.10992876440286636, 0.10613955557346344, 0.10243359208106995, 0.09881051629781723, 0.09526993334293365, 0.0918114110827446, 0.08843447268009186, 0.08513861149549484, 0.08192329108715057, 0.07878793030977249, 0.07573192566633224, 0.0727546215057373, 0.06985535472631454, 0.06703341007232666, 0.06428805738687515, 0.06161853298544884, 0.059024035930633545, 0.056503742933273315, 0.0540568046271801, 0.05168234184384346, 0.04937945306301117, 0.04714721441268921, 0.04498467221856117, 0.04289085417985916, 0.04086476191878319, 0.03890538588166237, 0.037011682987213135, 0.03518260270357132, 0.03341706842184067, 0.03171399235725403, 0.030072269961237907, 0.02849077619612217, 0.02696838043630123, 0.02550393156707287, 0.02409626916050911, 0.02274422161281109, 0.021446609869599342, 0.020202241837978363, 0.019009917974472046, 0.017868435010313988, 0.01677658036351204, 0.015733137726783752, 0.014736886136233807, 0.013786603696644306, 0.012881063856184483, 0.012019040994346142, 0.011199308559298515, 0.010420642793178558, 0.009681819006800652, 0.008981618098914623, 0.0083188246935606, 0.0076922280713915825, 0.0071006231009960175, 0.006542811635881662, 0.006017603911459446, 0.005523819476366043, 0.005060287192463875, 0.004625846166163683, 0.004219347611069679, 0.003839655313640833, 0.003485647030174732, 0.003156213788315654, 0.0028502624481916428, 0.0025667159352451563, 0.0023045139387249947, 0.002062613843008876, 0.0018399915425106883, 0.0016356422565877438, 0.00144858134444803, 0.0012778451200574636, 0.0011224912013858557, 0.0009815999073907733, 0.0008542740833945572, 0.0007396407891064882, 0.0006368511239998043, 0.0005450814496725798, 0.0004635336808860302, 0.0003914359549526125, 0.00032804335933178663, 0.0002726383681874722, 0.00022453143901657313, 0.0001830615510698408, 0.00014759662735741585, 0.00011753410217352211, 9.230136492988095e-05, 7.135613850550726e-05, 5.418695218395442e-05, 4.031349453725852e-05, 2.9286984499776736e-05, 2.0690509700216353e-05, 1.4139350241748616e-05, 9.28125336940866e-06, 5.796714503958356e-06, 3.399207116672187e-06, 1.8354062376602087e-06, 8.853747885950725e-07, 3.627314413279237e-07, 1.1479065875619199e-07, 2.2677545175042724e-08, 1.4174532658728367e-09};
const float32_t input_f[2048] = INPUT_F;
const float32_t output_f[2048] = OUT_F;

static void init_nn()
{
	memset(&nn, 0, sizeof(nn));
	memcpy(nn.pWindow, HANNING_WIN, sizeof(HANNING_WIN));
}

static void prepare_test_data()
{
	memcpy(nn.input_buffer + PRE_PADDING_SIZE, input_f, sizeof(input_f));
	//clear output
	// memset(test_output, 0, sizeof(test_output));
	memset(nn.output_buffer, 0, sizeof(nn.output_buffer));
}

static void run_test(float32_t* input, int size, float32_t* output)
{
	// ASSERT(INPUT_FRAME_SIZE == size, "input size should be %d", INPUT_FRAME_SIZE);
	//1. prepare the input buffer
	//move data from last half to first half
	//arm_copy_f32(nn.input_buffer + (INPUT_FRAME_SIZE + PRE_PADDING_SIZE), nn.input_buffer + PRE_PADDING_SIZE, INPUT_FRAME_SIZE);
	//copy new data to last half
	//arm_copy_f32(input, nn.input_buffer + (INPUT_FRAME_SIZE + PRE_PADDING_SIZE), INPUT_FRAME_SIZE);
	
	//mirrow header data
	int offset = 0;
	for (int i = 0; i < PRE_PADDING_SIZE; ++i)
	{
		nn.input_buffer[offset + i] = nn.input_buffer[offset + PRE_PADDING_SIZE * 2 - i];
	}
	//mirrow tail data
	offset = INPUT_FRAME_SIZE * 2 + PRE_PADDING_SIZE - POST_PADDING_SIZE;
	// offset = INPUT_FRAME_SIZE * 2 + PRE_PADDING_SIZE;
	for (int i = 0; i < POST_PADDING_SIZE; ++i)
	{
		nn.input_buffer[INPUT_BUFFER_SIZE - 1 -i] = nn.input_buffer[offset + i - 1];
	}
	
	//perform stft
	arm_rfft_fast_init_f32(&nn.fft, FFT_SIZE);

	//TODO
	// to optimize it, some magnitudes are already calculated for previous buffer, just copy them
	for (int i = 0; i < FFT_FRAMES; ++i)
	{
		offset = i * FFT_STEP;
		//apply window
		arm_mult_f32(nn.input_buffer + offset, nn.pWindow, nn.fft_tmp, FFT_SIZE);
		//do fft
		arm_rfft_fast_f32(&nn.fft, nn.fft_tmp, nn.fft_result + i * FFT_SIZE, 0);
		//calc mag [X[0], X[N/2], real, img, real, img ...]
		arm_cmplx_mag_f32(nn.fft_result + i * FFT_SIZE + 2, nn.nn_input + i * (FFT_SIZE / 2), FFT_SIZE / 2);
		nn.nn_input[(i + 1) * (FFT_SIZE / 2) - 1] = nn.fft_result[i * FFT_SIZE + 1];
	}
	
	// dB -> normalize -> quantize
	for (int i = 0; i < (FFT_SIZE / 2) * FFT_FRAMES; ++i){
		nn.nn_input_q15[i] = ROUND_TO_Q15(4096 * (20*log10f(nn.nn_input[i]) + 37.79) / 13.55);
	}

	//run NN
	run_nn(nn.nn_input_q15, nn.nn_output_q15);
	//memcpy(nn.nn_input_q15, output_q, sizeof(output_q));
	
	// just copy input to output for testing
	/*for (int i=0; i < 256*9; ++i){
		nn.nn_output_q15[i] = nn.nn_input_q15[i];
	}*/
	
	// dequantize -> denormaize -> amp
	for (int i = 0; i < (FFT_SIZE / 2) * FFT_FRAMES; ++i){
		nn.nn_output[i] = powf(10, (((float32_t)(nn.nn_output_q15[i]) / 4096) * 13.55 - 37.79)/20); 
	}
	

	//perform istft
	//only consider the last half TODO
	for (int i = 0; i < FFT_FRAMES; ++i)
	{
		//calc the ratio of output/input and update fft_result
		
		for (int j = 0; j < (FFT_SIZE / 2) - 1; ++j){
			nn.fft_tmp[2 * (j + 1)] = nn.nn_output[i * (FFT_SIZE / 2) + j] / nn.nn_input[i * (FFT_SIZE / 2) + j];
			nn.fft_tmp[2 * (j + 1) + 1] = nn.fft_tmp[2 * (j + 1)];
		}
		nn.fft_tmp[0] = 1;
		nn.fft_tmp[1] = nn.nn_output[i * (FFT_SIZE / 2) + 255] / nn.nn_input[i * (FFT_SIZE / 2) + 255]; 
		
		/*if (i == 5){
			for (int k=0; k < 512; ++k){
			PRINTF("\r\n %f \r\n", nn.fft_tmp[k]);
			}
		}*/
		
		//apply ratio to fft_result
		arm_mult_f32(nn.fft_result + i * FFT_SIZE, nn.fft_tmp, nn.fft_result + i * FFT_SIZE, FFT_SIZE);
		//ifft
		arm_rfft_fast_f32(&nn.fft, nn.fft_result + i * FFT_SIZE, nn.fft_tmp, 1);
		//window again
		arm_mult_f32(nn.fft_tmp, nn.pWindow, nn.fft_tmp, FFT_SIZE);

		//move last half part of output_buffer to the first part
		//arm_copy_f32(nn.nn_output + FFT_STEP, nn.nn_output, FFT_SIZE - FFT_STEP);
		//arm_fill_f32(0, nn.nn_output + FFT_SIZE - FFT_STEP, FFT_STEP);

		//overlay add 
		//arm_add_f32(nn.nn_output, nn.fft_tmp, nn.nn_output, FFT_SIZE);
		arm_add_f32(nn.output_buffer + i * FFT_SIZE / 2, nn.fft_tmp, nn.output_buffer + i * FFT_SIZE / 2, FFT_SIZE);
		
		//copy FFT_STEP data to output
		//arm_copy_f32(nn.nn_output, output + i * FFT_STEP, FFT_STEP);
	}
	for (int i = 1; i < INPUT_BUFFER_SIZE; ++i){
		nn.output_buffer[i] = nn.output_buffer[i] / WSUM[i];
	}
} 





int main(void)
{
    /* Board pin, clock, debug console init */
    BOARD_ConfigMPU();
    BOARD_InitPins();
    BOARD_BootClockRUN();
    BOARD_InitDebugConsole();
	
		ARM_CM_DEMCR      |= 1 << 24;  // Set bit 24
	  ARM_CM_DWT_CYCCNT  = 0;
	  ARM_CM_DWT_CTRL   |= 1 << 0;   // Set bit 0
	
		uint32_t start;
		uint32_t latency;
		uint32_t iter = 10;
		
		//q15_t input_data[256*9] = INPUT_DATA;
		// q15_t output_data_ref[256*9] = OUT;
		//q15_t output_data[256*9];
		//float32_t stft_ref[256*9] = INPUT_STFT;
	
		init_nn();
		prepare_test_data();
	
		PRINTF("\r\n Inference begin! \r\n");
		start = ARM_CM_DWT_CYCCNT;
	
		for (int i=0; i<iter; i++){
			//run_nn(input_data, output_data);
			memset(nn.output_buffer, 0, sizeof(nn.output_buffer));
			run_test(test_input, INPUT_FRAME_SIZE, test_output);
		}
		
		latency = ARM_CM_DWT_CYCCNT - start;
		
		for (int i=0; i< 2048; i++){
			PRINTF("\r\n %d  ref: %f  pred: %f \r\n", i, output_f[i], nn.output_buffer[i+256]);
		}
		
		
		/* for (int i=0; i< 256*9; i++){
			PRINTF("\r\n %d  ref: %d  pred: %d \r\n", i, output_data_ref[i], nn.nn_output_q15[i]);
		} */
	
		PRINTF("\r\n latency: %d ms \r\n", latency / (528000*iter));

    while (1)
    {
    }

}
